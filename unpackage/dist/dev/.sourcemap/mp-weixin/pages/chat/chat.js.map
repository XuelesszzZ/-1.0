{"version":3,"sources":["uni-app:///main.js",null,"webpack:///D:/仿微信wechat/pages/chat/chat.vue?1e4c","webpack:///D:/仿微信wechat/pages/chat/chat.vue?d2ed","webpack:///D:/仿微信wechat/pages/chat/chat.vue?6d72","uni-app:///pages/chat/chat.vue","webpack:///D:/仿微信wechat/pages/chat/chat.vue?4ac6","webpack:///D:/仿微信wechat/pages/chat/chat.vue?d185"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","showQuickReply","selectedQuickReplyItem","roomType","info","kjList","isHistoryLoading","scrollAnimation","scrollTop","scrollToView","windowHeight","emojData","swiperIndex","selectedEmoji","msgImgList","historyList","fromUserInfo","formData","content","limit","index","showOrderPopup","showcustomer","ws","hosId","loading","hosType","status","messageList","popTile","jkId","infoLeft","uni","icon","title","uploadType","components","OrderPopup","customer","QuickReply","watch","methods","dataContent","console","getList","client_id","resolve","scrollBool","handleQuickReplyClick","del","arr","loadHistory","setTimeout","setPicSize","handleSelectOrder","handleSelect","closeBox","closeKf","init","maxReconnect","reconnectDelay","heartbeatInterval","i","gethistoryList","switchChatType","emogiFun","switchFun","tuchEmoj","swiperChange","sendMsg","token","type","shop_id","user_id","content_type","room_type","sedData","touchstart","linkToBusinessCard","startVoice","format","beginVoice","moveVoice","endVoice","cancelVoice","handleRecorder","tempFilePath","duration","contentDuration","contentType","handleAudio","playAudio","item","stopAudio","closeAnmition","clickGrid","chooseImage","count","mediaType","sourceType","maxDuration","success","uploadFiles","uploadImageInH5","fetch","response","blob","file","result","uploadImageInMiniProgram","url","filePath","name","header","path","reject","fail","Promise","then","catch","viewImg","urls","onPageScroll","onNavigationBarButtonTap","onBackPress","onUnload","onLoad","params","clearInterval","onReady"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA6H;AAC7H;AACwD;AACL;AACsC;;;AAGzF;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,2FAAM;AACR,EAAE,oGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,+FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,2OAEN;AACP,KAAK;AACL;AACA,aAAa,qOAEN;AACP,KAAK;AACL;AACA,aAAa,2OAEN;AACP,KAAK;AACL;AACA,aAAa,+NAEN;AACP,KAAK;AACL;AACA,aAAa,6PAEN;AACP,KAAK;AACL;AACA,aAAa,+NAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,mBAAO,CAAC,6BAAoB;AAClE,yCAAyC,mBAAO,CAAC,gCAAuB;AACxE,WAAW,mBAAO,CAAC,4BAAmB;AACtC,WAAW,mBAAO,CAAC,2BAAkB;AACrC;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC3EA;AAAA;AAAA;AAAA;AAA8lB,CAAgB,wnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;ACsOlnB;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAKA;EACAC;IAAA;IACA;MACAC;MACAC;MACAC;MACAC;MACAC,UACA;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MACA;MACA,CACA,4DACA,4DACA,0DACA,WACA;MAEA;MACA,CACA,4DACA,4DACA,6DACA,WACA;MAEA;MACA,CACA,4DACA,4DACA,4DACA,WACA;MAEA;MACA,CACA,4DACA,4DACA,4DACA,WACA;MAEA;MACA,CACA,4DACA,4DACA,2DACA,WACA,CACA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC,eAEA;MACAC;MACAC;MACAC;IAAA,kDACA,wDACA,gEACA,wDACA,4DACA,4DACA,qDACAC,wEACAA,iFACA,2DACA,6DACA,wDACA,mDACA,qDACA,yDACA,8DACA,wDACA,yDACA,sEACA,sDACA;MACAC;MACAC;MACAC;IACA,GACA;MACAF;MACAC;MACAC;IACA,GACA;MACAF;MACAC;IAEA,GACA;MACAD;MACAC;IACA,GACA;MACAD;MACAC;IACA,EACA,mDACA;EAEA;EACAE;IACAC;IACAC;IACAC;EACA;EACAC;IACA;IACAvC;MACA;QACA;MACA;IACA;EACA;EACAwC;IACA;IACAC;MACAC;IAEA;IACA;IACAC;MAAA;MACAD;MAEA;QACA;UACAE;QACA;UACA;YACA;YACA;YACAF;UAEA;UACAG;QACA;UACAA;UACA;QACA;MACA;IACA;IACAC;MACA;IAEA;IACAC;MACA;MACA;MACA;MACA;QACA;UACA;UAEA;QACA;UACA;UACA;UACA;QACA;MACA;QAEA;QAEA;MACA;IACA;IACAC;MAEA;MACAC;MACA;MACAP;IACA;IACA;IACAQ;MAAA;MACAR;MACA;QACA;MACA;MACA;MACA;MACA;MACA;MACAS;QACA;;QAEAT;QACA;QACA;UAEA;UACA;QACA;QACA;QACA;UACA;UACA;YACA;UACA;QAEA;;QACA;MAEA;IACA;IAEA;IACAU;MACA;MACA;MACA;MACA;QACA;QACAnC;QACAA;MACA;MACA;IACA;IACA;IACAoC;MAEA;;MAEA;IACA;IACA;IACAC,2CAEA;IACA;IACAC;MAEA;IACA;IACAC;MAEA;IACA;IACAC;MAAA;MACA;MACA;QACAC;QAAA;QACAC;QAAA;QACAC;MACA;;MAEA;MACA;QAEA;MACA;MACA;MACA;MACA;QAAA;MAAA;MACA;QAAA;MAAA;MACA;QACAlB;QACA;UAEA;UACA;QAEA;QAEA;UACA;UACA;UAEA,uBACA;YACAmB;YACAA;YACA;cACAA;YACA;cACAA;YACA;UAEA,EAGA;QAEA;QAEA;UACA;UACA;UACA;YACA;UAEA;QAEA;MAEA;IACA;IAEA;IACAC;MAAA;MAEA;QACA;UACAlB;QACA;UAEA;YACA;UACA;UACAC;QACA;UAEAA;UACA;QACA;MACA;IAEA;IAOA;IACAkB;MAEA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACAjC;MACA;IAGA;IACA;IACAkC;MACA;MACA;MACA;MACA;MACAlC;IAEA;IACAmC;MACA;IAEA;IACAC;MACA;IACA;IAGA;IACAC;MAAA;MACA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAxD;QACAyD;MAEA;MACA;QACAC;MAEA;QACAA;MACA;MAGA;QACA;UACA;UACAA;UACAA;UACAA;QAEA;UACA;UACAA;UACAA;UACAA;QAGA;UACA;UACAA;UACAA;UACAA;UACAA;UACAA;QAEA;UACA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;QAGA;MACA;QACA;QACA;MACA;MAEA;MAEAA,sBACAA;MACA;MACA,qBACA;QACAd;MACA,EAEA;MAEA;QAEA;QAGA;QAOA;UACA;QACA;QAGA;UACA;QACA;;QAEA;MAIA;IACA;IACA;IACAe;MACA7C;MACA;MACA;IAEA;IACA;IACA8C;MACA;MACA;MACA;MACA;MACA;MACA;IAAA,CACA;IACA;IACAC;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAC;MACA;IACA;IACA;IACAC;MAAA;MACA;QACA;QACA;MACA;MACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;QACA;QACA;MACA;QACA;QACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACA;IACAC,+CAGA;MAAA;MAAA,IAFAC;QACAC;MAEA;MAEA;MACA;QACA;QACAnC;UACA;QACA;QACA;MACA;MACAoC;MAeA;MACA;QACAC;QACAvE;QACAsE;MACA;MACA;IACA;IACA;IACAE;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACAC;IACA;IACA;IACAC;MACAD;MACA;MACA;IACA;IACA;IACAE;MACA;MACA;QAAA;MAAA;MACAF;IACA;IACA;IACAG;MACA;QACA;MACA;QACA;MACA;QAEA;QACA;QACA;MACA;QAEA;QACA;QACA;MACA;QACA;UACAzB;UACAC;UACAI;QACA;QACA;QACA;QACA;MACA;IACA;IACA;IACAqB;MAAA;MACAhE;QACAiE;QACAC;QAAA;QACAC;QACAC;QACAC;UACA;UAEA;QACA;MACA;IAEA;IACA;IACAC;MAEA;;MAMA;IAEA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAGAC;cAAA;gBAAAC;gBAAA;gBAAA,OACAA;cAAA;gBAAAC;gBACAC;kBACApC;gBACA,IAEA;gBACAtD;gBACAA;gBACAA;;gBAEA;gBAAA;gBAAA,OACA;cAAA;gBAAA2F;gBACAjE;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACA;IACAkE;MAAA;MAEA;QAEA;UACA7E;YACA8E;YACAC;YACAC;YAAA;YACAC;cACA;YAEA;YACAhG;cACA4B;YACA;YACAwD;cACA;gBACA;kBACA;kBAEA;oBACAZ;oBACAvE;oBACAgG;kBACA;gBAEA;kBACAC;gBACA;cACA;gBACAA;cACA;YACA;YACAC;cACAD;YACA;UACA;QACA;MACA;;MAEA;MACAE,yBACAC;QACA;QACA3E;MAIA,GACA4E;QACA5E;QACAX;UACAE;UACAD;QACA;MACA;IAEA;IACA;IACAuF;MACAxF;QACAyF;MAIA;IACA;EACA;EACAC;;IAEA;IACA;EAAA,CACA;EAGAC,mEAEA;IAAA,IADAvG;IAEA;MACA;IAAA,CACA;MAEA;MACA;QACAmD;QACAuC;MACA;IACA;EACA;EACA;EACAc;IACA;IACA;IACA;MACArD;MACAuC;IACA;IACA;EACA;EACAe;IACA;MACAlD;MACAJ;MACAD;IACA;IACA;IAEA;MACA;IACA;EACA;EACAwD;IAAA;IAGA;MACA;MACA;MACA;QACA;MAEA;IAEA;IAGA;IACA9F;MACAE;IACA;IACA;IACA;MAEAuC;MACAD;MACAG;MACAJ;MACAD;IACA;IACA;IACA;MACAyD;MACA;IACA;MACAA;MACA;IACA;IAEA;;IAEA;IACA;MACA;IACA;;IAIA;IACA;MAEA;IACA;IACA;IACA;MACAC;MACA;IACA;;IAEA;IACA;MACA;IACA;;IAEA;IACA;MACA;IACA;EACA;EACAC;IAAA;IACA;;IAMAjG;MACAE;IACA;IACA;IACAF;MACAqE;QACA;MACA;IACA;IAEArE;MACA;QAEA;MAEA;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC9mCA;AAAA;AAAA;AAAA;AAAiqC,CAAgB,uoCAAG,EAAC,C;;;;;;;;;;;ACArrC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=bf16e7f4&scoped=true&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&id=bf16e7f4&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bf16e7f4\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=template&id=bf16e7f4&scoped=true&\"","var components\ntry {\n  components = {\n    uAvatar: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-avatar/u-avatar\" */ \"uview-ui/components/u-avatar/u-avatar.vue\"\n      )\n    },\n    uImage: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-image/u-image\" */ \"uview-ui/components/u-image/u-image.vue\"\n      )\n    },\n    uButton: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-button/u-button\" */ \"uview-ui/components/u-button/u-button.vue\"\n      )\n    },\n    uGrid: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-grid/u-grid\" */ \"uview-ui/components/u-grid/u-grid.vue\"\n      )\n    },\n    uGridItem: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-grid-item/u-grid-item\" */ \"uview-ui/components/u-grid-item/u-grid-item.vue\"\n      )\n    },\n    uIcon: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-icon/u-icon\" */ \"uview-ui/components/u-icon/u-icon.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.chatType === \"voice\" ? require(\"@/static/voice.png\") : null\n  var m1 = _vm.chatType === \"keyboard\" ? require(\"@/static/keyboard.png\") : null\n  var m2 = require(\"@/static/face.png\")\n  var m3 = require(\"@/static/add.png\")\n  var g0 = _vm.$u.trim(this.formData.content)\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0,\n        m1: m1,\n        m2: m2,\n        m3: m3,\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"content\">\r\n\t\t<view class=\"content-box\" @touchstart=\"touchstart\" id=\"content-box\"\r\n\t\t\t:class=\"{'emoji-active':showFunBtn, 'emoji-active': emogiBox, 'showQuickReply-active': showQuickReply}\">\r\n\t\t\t<!-- 背景图- 定位方式 -->\r\n\t\t\t<!-- \t<image class=\"content-box-bg\" :src=\"_user_info.chatBgImg\" :style=\"{ height: imgHeight }\"></image> -->\r\n\t\t\t<view class=\"serviceReminder\">\r\n\t\t\t\t<u-avatar :src=\"infoData.headimgurl\" size=\"80\"></u-avatar>\r\n\t\t\t\t<view class=\"minderText\">\r\n\t\t\t\t\t{{infoData.title}},前来服务~\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<scroll-view class=\"msg-list\" scroll-y=\"true\" :scroll-with-animation=\"scrollAnimation\"\r\n\t\t\t\t:scroll-top=\"scrollTop\" :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\"\r\n\t\t\t\tref=\"scrollContainer\" upper-threshold=\"50\" @click=\"scrollBool\">\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\" v-if=\"isHistoryLoading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"message\" v-for=\"(item, index) in messageList\" :key=\"index\"\r\n\t\t\t\t\t:id=\"`msg-${item.hasBeenSentId}`\">\r\n\r\n\t\t\t\t\t<view class=\"message-item \" :class=\"item.is_me ? 'right' : 'left'\">\r\n\r\n\t\t\t\t\t\t<!-- contentType = 1 文本 -->\r\n\t\t\t\t\t\t<view class=\"content\" v-if=\"item.content_type == 1\">{{ item.content }}</view>\r\n\t\t\t\t\t\t<!-- contentType = 2 图片 -->\r\n\t\t\t\t\t\t<view class=\"content contentType3\" v-if=\"item.content_type == 2\" @tap=\"viewImg([item.path])\">\r\n\t\t\t\t\t\t\t<image :src=\"item.path\" class=\"img\" mode=\"widthFix\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- contentType = 3 视频 -->\r\n\t\t\t\t\t\t<view class=\"contentVideo \" v-if=\"item.content_type == 3\">\r\n\t\t\t\t\t\t\t<video :src=\"item.path\"></video>\r\n\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- contentType = 4 商品卡片 -->\r\n\t\t\t\t\t\t<view class=\"contentGoods \" v-if=\"item.content_type == 4\">\r\n\t\t\t\t\t\t\t<view class=\"goodsTop\">\r\n\t\t\t\t\t\t\t\t<view class=\"top_img\">\r\n\t\t\t\t\t\t\t\t\t<u-image :src=\"item.sender_id != undefined?item.content.thumb_url:item.thumb_url\"\r\n\t\t\t\t\t\t\t\t\t\twidth=\"130rpx\" height=\"120rpx\"></u-image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"topText\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"text\">\r\n\t\t\t\t\t\t\t\t\t\t{{item.sender_id != undefined?item.content.title:item.title}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"price\">\r\n\r\n\t\t\t\t\t\t\t\t\t\t￥{{item.sender_id != undefined?item.content.price:item.price}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"goodsFooter\">\r\n\t\t\t\t\t\t\t\t<u-button size=\"mini\" shape=\"circle\"\r\n\t\t\t\t\t\t\t\t\t:custom-style=\"{background: '#FF4400',color: '#fff'}\">去购买</u-button>\r\n\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- contentType = 5 订单卡片 -->\r\n\t\t\t\t\t\t<view class=\"contentOrder \" v-if=\"item.content_type == 5\">\r\n\t\t\t\t\t\t\t<view class=\"title\">\r\n\t\t\t\t\t\t\t\t我要咨询这笔订单\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"goodsTop\">\r\n\t\t\t\t\t\t\t\t<view class=\"top_img\">\r\n\t\t\t\t\t\t\t\t\t<u-image\r\n\t\t\t\t\t\t\t\t\t\t:src=\"item.sender_id != undefined?item.content.goods.thumb_url:item.thumb_url\"\r\n\t\t\t\t\t\t\t\t\t\twidth=\"130rpx\" height=\"120rpx\"></u-image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"topText\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"text\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"shopText\">\r\n\t\t\t\t\t\t\t\t\t\t\t{{item.sender_id != undefined?item.content.shop.title:item.shop_title}}\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"title\">\r\n\t\t\t\t\t\t\t\t\t\t\t{{item.sender_id != undefined?item.content.goods.title:item.title}}\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"price\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"num1\">\r\n\t\t\t\t\t\t\t\t\t\t\t￥{{item.sender_id != undefined?item.content.goods.price:item.price}}\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"num\">\r\n\t\t\t\t\t\t\t\t\t\t\t共{{item.sender_id != undefined?item.content.goods.num:item.num}}件商品\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t<view class=\"orderNum\">\r\n\t\t\t\t\t\t\t\t<view class=\"bh\">\r\n\t\t\t\t\t\t\t\t\t订单编号:{{item.sender_id != undefined?item.content.order_number:item.order_number}}\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"bh\">\r\n\t\t\t\t\t\t\t\t\t订单时间:{{item.sender_id != undefined?item.content.order_time:item.order_time}}\r\n\t\t\t\t\t\t\t\t</view>\r\n\r\n\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"goodsFooter\">\r\n\t\t\t\t\t\t\t\t<u-button size=\"mini\" shape=\"circle\"\r\n\t\t\t\t\t\t\t\t\t:custom-style=\"{background: '#2b85e4',color: '#fff'}\">查看订单</u-button>\r\n\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\r\n\r\n\r\n\t\t\t\t\t\t<!-- contentType = 2 语音 -->\r\n\t\t\t\t\t\t<!-- {{item.hasBeenSentId != undefined?item.content.title:item.title}}-->\r\n\t\t\t\t\t\t<!-- \t\t\t\t\t<view class=\"content contentType2\" :class=\"[{ 'content-type-right': item.is_me }]\"\r\n\t\t\t\t\t\tv-if=\"item.content_type == 3\" @tap=\"handleAudio(item)\" hover-class=\"contentType2-hover-class\"\r\n\t\t\t\t\t\t:style=\"{width:`${130+(item.contentDuration*2)}rpx`}\">\r\n\t\t\t\t\t\t<view class=\"voice_icon\" :class=\"[\r\n\t\t\t\t\t\t\t\t{ voice_icon_right: item.is_me },\r\n\t\t\t\t\t\t\t\t{ voice_icon_left: !item.is_me },\r\n\t\t\t\t\t\t\t\t{ voice_icon_right_an: item.anmitionPlay && item.is_me },\r\n\t\t\t\t\t\t\t\t{ voice_icon_left_an: item.anmitionPlay && !item.is_me }\r\n\t\t\t\t\t\t\t]\"></view>\r\n\t\t\t\t\t\t<view class=\"\">{{ item.contentDuration }}''</view>\r\n\t\t\t\t\t</view> -->\r\n\r\n\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t\t<view class=\"kjBox\">\r\n\t\t\t\t<view class=\"quick-reply\" v-for=\"(item, index) in kjList\" :key=\"index\"\r\n\t\t\t\t\t@click=\"handleQuickReplyClick(item,index)\"\r\n\t\t\t\t\t:class=\"{ 'selected': selectedQuickReplyIndex === index }\">\r\n\t\t\t\t\t{{item.name}}\r\n\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 底部聊天输入框 -->\r\n\t\t<view class=\"input-box\" :class=\"{ 'input-box-mpInputMargin': mpInputMargin }\">\r\n\t\t\t<view class=\"input-box-flex\">\r\n\t\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t\t<image v-if=\"chatType === 'voice'\" class=\"icon_img\" :src=\"require('@/static/voice.png')\"\r\n\t\t\t\t\t@click=\"switchChatType('keyboard')\"></image>\r\n\t\t\t\t<image v-if=\"chatType === 'keyboard'\" class=\"icon_img\" :src=\"require('@/static/keyboard.png')\"\r\n\t\t\t\t\t@click=\"switchChatType('voice')\"></image>\r\n\t\t\t\t<!-- #endif -->\r\n\t\t\t\t<view class=\"input-box-flex-grow\">\r\n\t\t\t\t\t<input v-if=\"chatType === 'voice'\" type=\"text\" class=\"content\" id=\"input\" v-model=\"formData.content\"\r\n\t\t\t\t\t\t:hold-keyboard=\"true\" :confirm-type=\"'send'\" :confirm-hold=\"true\"\r\n\t\t\t\t\t\tplaceholder-style=\"color:#DDDDDD;\" :cursor-spacing=\"10\" @confirm=\"sendMsg(null)\" />\r\n\t\t\t\t\t<view class=\"voice_title\" v-if=\"chatType === 'keyboard'\"\r\n\t\t\t\t\t\t:style=\"{ background: recording ? '#c7c6c6' : '#FFFFFF' }\" @touchstart.stop.prevent=\"startVoice\"\r\n\t\t\t\t\t\t@touchmove.stop.prevent=\"moveVoice\" @touchend.stop=\"endVoice\" @touchcancel.stop=\"cancelVoice\">\r\n\t\t\t\t\t\t{{ voiceTitle }}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- 表情按钮 -->\r\n\t\t\t\t<image class=\"emoji icon_btn_add\" :src=\"require('@/static/face.png')\" @tap=\"emogiFun\"></image>\r\n\t\t\t\t<!-- 功能性按钮 -->\r\n\t\t\t\t<image class=\" icon_btn_add\" :src=\"require('@/static/add.png')\" @tap=\"switchFun\"></image>\r\n\r\n\t\t\t\t<!-- #ifdef H5 -->\r\n\t\t\t\t<button class=\"btn\" type=\"primary\" size=\"mini\" @touchend.prevent=\"sendMsg(null)\">发送</button>\r\n\t\t\t\t<!-- #endif -->\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"fun-box\" :class=\"{'show-fun-box':showFunBtn}\">\r\n\t\t\t\t<u-grid :col=\"4\" hover-class=\"contentType2-hover-class\" :border=\"false\" @click=\"clickGrid\">\r\n\t\t\t\t\t<u-grid-item v-for=\"(item, index) in funList\" :index=\"index\" :key=\"index\" bg-color=\"#eaeaea\">\r\n\t\t\t\t\t\t<u-icon :name=\"item.icon\" :size=\"52\"></u-icon>\r\n\t\t\t\t\t\t<view class=\"grid-text\">{{ item.title }}</view>\r\n\t\t\t\t\t</u-grid-item>\r\n\t\t\t\t</u-grid>\r\n\t\t\t</view>\r\n\t\t\t<!-- 表情选择 -->\r\n\t\t\t<view class=\"fun-box\" :class=\"{'show-fun-box':emogiBox}\">\r\n\t\t\t\t<swiper :current=\"swiperIndex\" style=\"height: 100%;\" @change=\"swiperChange\" :indicator-dots=\"true\">\r\n\t\t\t\t\t<swiper-item v-for=\"(items, index) in emojData\" :key=\"index\">\r\n\t\t\t\t\t\t<view class=\"emoj-container\">\r\n\t\t\t\t\t\t\t<view class=\"emoj-row\">\r\n\t\t\t\t\t\t\t\t<view class=\"emoj-parent\" v-for=\"(item, i) in items\" :key=\"i\" hover-class=\"checkActive\"\r\n\t\t\t\t\t\t\t\t\thover-stay-time=\"100\" @click=\"tuchEmoj(item)\">\r\n\t\t\t\t\t\t\t\t\t<text class=\"emoj-conn\">{{ item }}</text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</swiper-item>\r\n\r\n\t\t\t\t</swiper>\r\n\t\t\t\t<view class=\"buttonBox\" v-if=\"$u.trim(this.formData.content)\">\r\n\t\t\t\t\t<u-button size='mini' class=\"firstBut\" :custom-style=\"{background: '#fff'}\" @click=\"del\">\r\n\t\t\t\t\t\t<u-icon name=\"backspace\" size=\"30\" color='#000'></u-icon>\r\n\t\t\t\t\t</u-button>\r\n\t\t\t\t\t<u-button size='mini' type=\"primary\" hairline=\"false\" @click=\"sendMsg\">发送</u-button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 快捷用语入口 -->\r\n\t\t\t<QuickReply :visible=\"showQuickReply\" :item=\"selectedQuickReplyItem\"   :commonList = 'commonList'   @dataContent=\"dataContent\" />\r\n\t\t</view>\r\n\r\n\t\t<!-- 订单商品弹出 -->\r\n\t\t<order-popup :visible=\"showOrderPopup\" @select=\"handleSelectOrder\" :jkid='jkId' @closeBox='closeBox'\r\n\t\t\t:title='popTile' />\r\n\t\t<!-- 客服 -->\r\n\t\t<customer :visible=\"showcustomer\" @select=\"handleSelect\" @closeBox='closeKf'></customer>\r\n\t\t<!-- //语音动画 -->\r\n\t\t<view class=\"voice_an\" v-if=\"recording\">\r\n\t\t\t<view class=\"voice_an_icon\">\r\n\t\t\t\t<view id=\"one\" class=\"wave\"></view>\r\n\t\t\t\t<view id=\"two\" class=\"wave\"></view>\r\n\t\t\t\t<view id=\"three\" class=\"wave\"></view>\r\n\t\t\t\t<view id=\"four\" class=\"wave\"></view>\r\n\t\t\t\t<view id=\"five\" class=\"wave\"></view>\r\n\t\t\t\t<view id=\"six\" class=\"wave\"></view>\r\n\t\t\t\t<view id=\"seven\" class=\"wave\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"text\">{{voiceIconText}}</view>\r\n\t\t</view>\r\n\t</view>\r\n\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tLOGIN_URL\r\n\t} from '../../env';\r\n\timport WebSocketUtil from '@/socket.js'\r\n\timport OrderPopup from '@/components/popup.vue'\r\n\timport customer from '@/components/customer.vue'\r\n\timport QuickReply from '@/components/QuickReply.vue';\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tshowQuickReply: false,\r\n\t\t\t\tselectedQuickReplyItem: null,\r\n\t\t\t\troomType: '',\r\n\t\t\t\tinfo: {},\r\n\t\t\t\tkjList: [\r\n\t\t\t\t],\r\n\t\t\t\tisHistoryLoading: false,\r\n\t\t\t\tscrollAnimation: false,\r\n\t\t\t\tscrollTop: 0,\r\n\t\t\t\tscrollToView: '',\r\n\t\t\t\twindowHeight: 0, // 动态计算高度\r\n\t\t\t\temojData: [\r\n\t\t\t\t\t// 分类1：笑脸与开心表情（33个）\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'😀', '😃', '😄', '😁', '😆', '😊', '😇', '🙂', '😋', '😎',\r\n\t\t\t\t\t\t'🥳', '🤩', '🤗', '😺', '😸', '😹', '😻', '😼', '😽', '🙌',\r\n\t\t\t\t\t\t'👏', '👍', '🎉', '✨', '🌟', '💫', '❤️', '💯', '✅', '🌈',\r\n\t\t\t\t\t\t'🚀', '😌',\r\n\t\t\t\t\t],\r\n\r\n\t\t\t\t\t// 分类2：爱心与浪漫（33个）\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'❤️', '🧡', '💛', '💚', '💙', '💜', '🖤', '🤍', '🤎', '💔',\r\n\t\t\t\t\t\t'❣️', '💕', '💞', '💓', '💗', '💖', '💘', '💝', '💟', '💌',\r\n\t\t\t\t\t\t'😍', '🥰', '😘', '😗', '😙', '😚', '😻', '💋', '️👨', '💏',\r\n\t\t\t\t\t\t'👦', '💐',\r\n\t\t\t\t\t],\r\n\r\n\t\t\t\t\t// 分类3：搞怪与顽皮（33个）\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'😜', '😝', '😛', '🤪', '😏', '😒', '😔', '😫', '😩', '😤',\r\n\t\t\t\t\t\t'😠', '😡', '🤬', '😈', '👿', '💀', '👻', '👽', '🤖', '🎃',\r\n\t\t\t\t\t\t'😺', '😸', '😹', '👀', '👅', '👄', '🦷', '👂', '👃', '🤡',\r\n\t\t\t\t\t\t'👺', '💩',\r\n\t\t\t\t\t],\r\n\r\n\t\t\t\t\t// 分类4：动物与自然（33个）\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯',\r\n\t\t\t\t\t\t'🦁', '🐮', '🐷', '🐸', '🐵', '🦄', '🐴', '🐦', '🐧', '🐔',\r\n\t\t\t\t\t\t'🐙', '🦑', '🐠', '🐳', '🌲', '🌳', '🌴', '🌵', '🌻', '🌸',\r\n\t\t\t\t\t\t'🦜', '🦢',\r\n\t\t\t\t\t],\r\n\r\n\t\t\t\t\t// 分类5：动作与物品（33个）\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'✌️', '🤞', '🤟', '🤘', '🤙', '👌', '👈', '👉', '👆', '👇',\r\n\t\t\t\t\t\t'🖐️', '✋', '👊', '🤛', '🤜', '🤚', '👋', '🖖', '💪', '🎈',\r\n\t\t\t\t\t\t'🎁', '🎂', '📱', '💻', '⌚', '📷', '🎮', '💰', '🔑', '🚗',\r\n\t\t\t\t\t\t'🛒', '🎒',\r\n\t\t\t\t\t]\r\n\t\t\t\t],\r\n\t\t\t\tswiperIndex: 0, // 初始 swiper 索引\r\n\t\t\t\tselectedEmoji: null, // 用于保存用户选择的表情\r\n\t\t\t\tmsgImgList: [],\r\n\t\t\t\thistoryList: [],\r\n\t\t\t\tfromUserInfo: {},\r\n\t\t\t\tformData: {\r\n\t\t\t\t\tcontent: '',\r\n\t\t\t\t\tlimit: 20,\r\n\t\t\t\t\tindex: 1\r\n\t\t\t\t},\r\n\t\t\t\tshowOrderPopup: false,\r\n\t\t\t\tshowcustomer: false,\r\n\t\t\t\tws: null,\r\n\t\t\t\thosId: '',\r\n\t\t\t\tloading: true, //标识是否正在获取数据\r\n\t\t\t\thosType: '',\r\n\t\t\t\tstatus: 'disconnected',\r\n\t\t\t\tmessageList: [\r\n\r\n\t\t\t\t],\r\n\t\t\t\tpopTile: '',\r\n\t\t\t\tjkId: '',\r\n\t\t\t\tinfoLeft: {},\r\n\t\t\t\tloading: true, //标识是否正在获取数据\r\n\t\t\t\timgHeight: '1000px',\r\n\t\t\t\tmpInputMargin: false, //适配微信小程序 底部输入框高度被顶起的问题\r\n\t\t\t\tchatType: \"voice\", // 图标类型 'voice'语音 'keyboard'键盘\r\n\t\t\t\tvoiceTitle: '按住 说话',\r\n\t\t\t\tcommonList: [],\r\n\t\t\t\tRecorder: uni.getRecorderManager(),\r\n\t\t\t\tAudio: uni.createInnerAudioContext(),\r\n\t\t\t\trecording: false, //标识是否正在录音\r\n\t\t\t\tisStopVoice: false, //加锁 防止点击过快引起的当录音正在准备(还没有开始录音)的时候,却调用了stop方法但并不能阻止录音的问题\r\n\t\t\t\tvoiceInterval: null,\r\n\t\t\t\tvoiceTime: 0, //总共录音时长\r\n\t\t\t\tcanSend: true, //是否可以发送\r\n\t\t\t\tPointY: 0, //坐标位置\r\n\t\t\t\tvoiceIconText: \"正在录音...\",\r\n\t\t\t\tshowFunBtn: false, //是否展示功能型按钮\r\n\t\t\t\temogiBox: false, //是否展示表情选择\r\n\t\t\t\tAudioExam: null, //正在播放音频的实例\r\n\t\t\t\tselectedQuickReplyIndex: null,\r\n\t\t\t\tfunList: [{\r\n\t\t\t\t\ticon: \"photo-fill\",\r\n\t\t\t\t\ttitle: \"照片\",\r\n\t\t\t\t\tuploadType: [\"album\"]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ticon: \"camera-fill\",\r\n\t\t\t\t\ttitle: \"拍摄\",\r\n\t\t\t\t\tuploadType: [\"camera\"]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ticon: \"order\",\r\n\t\t\t\t\ttitle: \"订单\",\r\n\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ticon: \"bag-fill\",\r\n\t\t\t\t\ttitle: \"商品\",\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ticon: \"kefu-ermai\",\r\n\t\t\t\t\ttitle: \"客服\"\r\n\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tinfoData: {}, // 初始化 infoData\r\n\t\t\t};\r\n\t\t},\r\n\t\tcomponents: {\r\n\t\t\tOrderPopup,\r\n\t\t\tcustomer,\r\n\t\t\tQuickReply\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\t// 取消选中\r\n\t\t\tshowQuickReply(val) {\r\n\t\t\t\tif (!val) {\r\n\t\t\t\t\tthis.selectedQuickReplyIndex = null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t//获取传递的文字\r\n\t\t\tdataContent(data){\r\n          console.log(data);\r\n\t\t  \r\n\t\t\t},\r\n\t\t\t//获取分类\r\n\t\t\tgetList(val) {\r\n\t\t\t\tconsole.log(val);\r\n\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tthis.$api('getCateList', {\r\n\t\t\t\t\t\tclient_id: val\r\n\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\tif (res.status == 200) {\r\n\t\t\t\t\t\t\tthis.kjList = res.data.common_list\r\n\t\t\t\t\t\t\tthis.commonList = res.data.cate_list\r\n\t\t\t\t\t\t\tconsole.log(this.commonList );\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresolve(true);\r\n\t\t\t\t\t}).catch((e) => {\r\n\t\t\t\t\t\tresolve(false);\r\n\t\t\t\t\t\t// console.log(e);\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tscrollBool() {\r\n\t\t\t\tthis.showQuickReply = false;\r\n\r\n\t\t\t},\r\n\t\t\thandleQuickReplyClick(item, index) {\r\n\t\t\t\tthis.emogiBox = false;\r\n\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\tthis.scrollToView = 'msg-0';\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tif (this.selectedQuickReplyIndex === index) {\r\n\t\t\t\t\t\tthis.selectedQuickReplyIndex = null;\r\n\r\n\t\t\t\t\t\tthis.showQuickReply = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.selectedQuickReplyIndex = index;\r\n\t\t\t\t\t\tthis.selectedQuickReplyItem = item;\r\n\t\t\t\t\t\tthis.showQuickReply = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.formData.content = item.content;\r\n\r\n\t\t\t\t\tthis.selectedQuickReplyIndex = null; // 点击其他项时不高亮\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdel() {\r\n\r\n\t\t\t\tlet arr = Array.from(this.formData.content); // 按字符拆分为数组\r\n\t\t\t\tarr = arr.slice(0, -1); // 删除最后一个字符\r\n\t\t\t\tthis.formData.content = arr.join('');\r\n\t\t\t\tconsole.log(this.formData.content);\r\n\t\t\t},\r\n\t\t\t//触发滑动到顶部(加载历史信息记录)\r\n\t\t\tloadHistory(e) {\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tif (this.isHistoryLoading) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.isHistoryLoading = true; //参数作为进入请求标识，防止重复请求\r\n\t\t\t\tthis.scrollAnimation = false; //关闭滑动动画\r\n\t\t\t\t// let Viewid = this.messageList[0].msg.id;//记住第一个信息ID\r\n\t\t\t\t//本地模拟请求历史记录效果\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// 消息列表\r\n\r\n\t\t\t\t\tconsole.log(this.historyList);\r\n\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\tfor (let i = 0; i < this.historyList.length; i++) {\r\n\r\n\t\t\t\t\t\tthis.historyList[i].hasBeenSentId = Math.floor(Math.random() * 1000 + 1);\r\n\t\t\t\t\t\tthis.messageList.unshift(this.historyList[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n\t\t\t\t\tthis.$nextTick(function () {\r\n\t\t\t\t\t\tthis.scrollToView = 'msg-19'\r\n\t\t\t\t\t\tthis.$nextTick(function () {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true; //恢复滚动动画\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.isHistoryLoading = false;\r\n\r\n\t\t\t\t}, 1000)\r\n\t\t\t},\r\n\r\n\t\t\t//处理图片尺寸，如果不处理宽高，新进入页面加载图片时候会闪\r\n\t\t\tsetPicSize(content) {\r\n\t\t\t\t// 让图片最长边等于设置的最大长度，短边等比例缩小，图片控件真实改变，区别于aspectFit方式。\r\n\t\t\t\tlet maxW = uni.upx2px(350); //350是定义消息图片最大宽度\r\n\t\t\t\tlet maxH = uni.upx2px(350); //350是定义消息图片最大高度\r\n\t\t\t\tif (content.w > maxW || content.h > maxH) {\r\n\t\t\t\t\tlet scale = content.w / content.h;\r\n\t\t\t\t\tcontent.w = scale > 1 ? maxW : maxH * scale;\r\n\t\t\t\t\tcontent.h = scale > 1 ? maxW / scale : maxH;\r\n\t\t\t\t}\r\n\t\t\t\treturn content;\r\n\t\t\t},\r\n\t\t\t//选中订单\r\n\t\t\thandleSelectOrder(item) {\r\n\r\n\t\t\t\tthis.sendMsg(item)\r\n\r\n\t\t\t\t// 跳转到订单详情页或其他操作\r\n\t\t\t},\r\n\t\t\t//转接客服\r\n\t\t\thandleSelect(item) {\r\n\r\n\t\t\t},\r\n\t\t\t//关闭\r\n\t\t\tcloseBox(data) {\r\n\r\n\t\t\t\tthis.showOrderPopup = data\r\n\t\t\t},\r\n\t\t\tcloseKf(data) {\r\n\r\n\t\t\t\tthis.showcustomer = data\r\n\t\t\t},\r\n\t\t\tinit(data) {\r\n\t\t\t\t// 初始化 WebSocket\r\n\t\t\t\tthis.ws = new WebSocketUtil('wss://192.168.0.119:8088/ws/', {\r\n\t\t\t\t\tmaxReconnect: 5, // 最大重连次数\r\n\t\t\t\t\treconnectDelay: 2000, // 重连间隔\r\n\t\t\t\t\theartbeatInterval: 100000 // 心跳间隔\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 监听事件\r\n\t\t\t\tthis.ws.on('open', () => {\r\n\r\n\t\t\t\t\tthis.status = 'connected'\r\n\t\t\t\t});\r\n\t\t\t\tthis.ws.send(data)\r\n\t\t\t\tthis.ws.startHeartbeat(data)\r\n\t\t\t\tthis.ws.on('close', () => this.status = 'disconnected');\r\n\t\t\t\tthis.ws.on('error', (err) => console.error('发生错误:', err));\r\n\t\t\t\tthis.ws.on('message', (res) => {\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tif (res.type == 'onConnect') {\r\n\r\n\t\t\t\t\t\tthis.jkId = res.data.client_id\r\n\t\t\t\t\t\tthis.gethistoryList(this.jkId)\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (res.type == 'login') {\r\n\t\t\t\t\t\tthis.messageList = res.data.list\r\n\t\t\t\t\t\tthis.info = res.data.sender_info\r\n\r\n\t\t\t\t\t\tthis.messageList.map(\r\n\t\t\t\t\t\t\t(i, index) => {\r\n\t\t\t\t\t\t\t\ti.path = i.content\r\n\t\t\t\t\t\t\t\ti.hasBeenSentId = this.messageList.length - 1 - index\r\n\t\t\t\t\t\t\t\tif (i.is_me) {\r\n\t\t\t\t\t\t\t\t\ti.is_me = true\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ti.is_me = false\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t)\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.$nextTick(function () {\r\n\t\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\t\tthis.scrollTop = 99999999999\r\n\t\t\t\t\t\tthis.$nextTick(function () {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t// 加载历史消息\r\n\t\t\tgethistoryList(page) {\r\n\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tthis.$api('history', {\r\n\t\t\t\t\t\tclient_id: page\r\n\t\t\t\t\t}).then(res => {\r\n\r\n\t\t\t\t\t\tif (res.status == 200) {\r\n\t\t\t\t\t\t\tthis.historyList = res.data.list\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresolve(true);\r\n\t\t\t\t\t}).catch((e) => {\r\n\r\n\t\t\t\t\t\tresolve(false);\r\n\t\t\t\t\t\t// console.log(e);\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\r\n\t\t\t},\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t//切换语音或者键盘方式\r\n\t\t\tswitchChatType(type) {\r\n\r\n\t\t\t\tthis.chatType = type;\r\n\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t},\r\n\t\t\t//打开表情选项\r\n\t\t\temogiFun() {\r\n\t\t\t\tthis.chatType = 'voice'\r\n\t\t\t\tthis.emogiBox = !this.emogiBox;\r\n\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\tthis.showQuickReply = false;\r\n\t\t\t\tthis.scrollToView = 'msg-0';\r\n\t\t\t\tuni.hideKeyboard();\r\n\t\t\t\t// this.scrollToView = 'msg-0';\r\n\r\n\r\n\t\t\t},\r\n\t\t\t//切换功能性按钮\r\n\t\t\tswitchFun() {\r\n\t\t\t\tthis.chatType = 'voice'\r\n\t\t\t\tthis.showFunBtn = !this.showFunBtn;\r\n\t\t\t\tthis.emogiBox = false\r\n\t\t\t\tthis.showQuickReply = false;\r\n\t\t\t\tuni.hideKeyboard()\r\n\r\n\t\t\t},\r\n\t\t\ttuchEmoj(item) {\r\n\t\t\t\tthis.formData.content += item\r\n\r\n\t\t\t},\r\n\t\t\tswiperChange(e) {\r\n\t\t\t\tthis.swiperIndex = e.detail.current;\r\n\t\t\t},\r\n\r\n\r\n\t\t\t//发送消息\r\n\t\t\tsendMsg(data) {\r\n\t\t\t\tconst sedData = {\r\n\t\t\t\t\ttoken: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\",\r\n\t\t\t\t\ttype: 'dialog',\r\n\t\t\t\t\tshop_id: null,\r\n\t\t\t\t\tuser_id: null,\r\n\t\t\t\t\tcontent_type: 1,\r\n\t\t\t\t\tcontent: this.formData.content,\r\n\t\t\t\t\troom_type: this.hosType\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (this.hosType === 1 || this.hosType === 2 || this.hosType === 3) {\r\n\t\t\t\t\tsedData.shop_id = this.hosId\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsedData.user_id = this.hosId\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tif (data.contentType == 3) {\r\n\t\t\t\t\t\t//说明是发送视频\r\n\t\t\t\t\t\tsedData.path = data.path\r\n\t\t\t\t\t\tsedData.content = data.content;\r\n\t\t\t\t\t\tsedData.content_type = data.contentType;\r\n\r\n\t\t\t\t\t} else if (data.contentType == 2) {\r\n\t\t\t\t\t\t//发送图片\r\n\t\t\t\t\t\tsedData.path = data.path\r\n\t\t\t\t\t\tsedData.content = data.content;\r\n\t\t\t\t\t\tsedData.content_type = data.contentType;\r\n\r\n\r\n\t\t\t\t\t} else if (data.contentType == 4) {\r\n\t\t\t\t\t\t//商品\r\n\t\t\t\t\t\tsedData.content = data.id\r\n\t\t\t\t\t\tsedData.content_type = data.contentType;\r\n\t\t\t\t\t\tsedData.thumb_url = data.thumb_url\r\n\t\t\t\t\t\tsedData.title = data.title\r\n\t\t\t\t\t\tsedData.price = data.price\r\n\r\n\t\t\t\t\t} else if (data.contentType == 5) {\r\n\t\t\t\t\t\t//订单\r\n\t\t\t\t\t\tsedData.content = data.fatherId + ':' + data.id\r\n\t\t\t\t\t\tsedData.content_type = data.contentType;\r\n\t\t\t\t\t\tsedData.thumb_url = data.thumb_url\r\n\t\t\t\t\t\tsedData.title = data.title\r\n\t\t\t\t\t\tsedData.price = data.price\r\n\t\t\t\t\t\tsedData.order_number = data.order_number\r\n\t\t\t\t\t\tsedData.order_time = data.order_time\r\n\t\t\t\t\t\tsedData.shop_title = data.shop_title\r\n\t\t\t\t\t\tsedData.num = data.num\r\n\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (!this.$u.trim(this.formData.content)) {\r\n\t\t\t\t\t//验证输入框书否为空字符传\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.ws.send(sedData)\r\n\r\n\t\t\t\tsedData.is_me = true,\r\n\t\t\t\t\tsedData.headimgurl = this.info.headimgurl\r\n\t\t\t\tthis.messageList.push(sedData);\r\n\t\t\t\tthis.messageList.map(\r\n\t\t\t\t\t(i, index) => {\r\n\t\t\t\t\t\ti.hasBeenSentId = this.messageList.length - 1 - index\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t)\r\n\r\n\t\t\t\tthis.$nextTick(() => {\r\n\r\n\t\t\t\t\tthis.formData.content = '';\r\n\t\t\t\t\t// #ifdef MP-WEIXIN\r\n\r\n\t\t\t\t\tthis.scrollToView = 'msg-0'\r\n\t\t\t\t\t// #endif\r\n\r\n\t\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\t\tthis.scrollToView = 'msg-0'\r\n\t\t\t\t\t// #endif\r\n\r\n\t\t\t\t\tif (this.showFunBtn) {\r\n\t\t\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// #ifdef MP-WEIXIN \r\n\t\t\t\t\tif (sedData.contentType == 1) {\r\n\t\t\t\t\t\tthis.mpInputMargin = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t//h5浏览器并没有很好的办法控制键盘一直处于唤起状态 而且会有样式性的问题\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tuni.hideKeyboard();\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//用户触摸屏幕的时候隐藏键盘\r\n\t\t\ttouchstart() {\r\n\t\t\t\tuni.hideKeyboard();\r\n\t\t\t\tthis.showFunBtn = false\r\n\t\t\t\tthis.emogiBox = false\r\n\r\n\t\t\t},\r\n\t\t\t// userid 用户id\r\n\t\t\tlinkToBusinessCard(userId) {\r\n\t\t\t\t// this.$u.route({\r\n\t\t\t\t// \turl: 'pages/businessCard/businessCard',\r\n\t\t\t\t// \tparams: {\r\n\t\t\t\t// \t\tuserId\r\n\t\t\t\t// \t}\r\n\t\t\t\t// });\r\n\t\t\t},\r\n\t\t\t//准备开始录音\r\n\t\t\tstartVoice(e) {\r\n\t\t\t\tif (!this.Audio.paused) {\r\n\t\t\t\t\t//如果音频正在播放 先暂停。\r\n\t\t\t\t\tthis.stopAudio(this.AudioExam)\r\n\t\t\t\t}\r\n\t\t\t\tthis.recording = true;\r\n\t\t\t\tthis.isStopVoice = false;\r\n\t\t\t\tthis.canSend = true;\r\n\t\t\t\tthis.voiceIconText = \"正在录音...\"\r\n\t\t\t\tthis.PointY = e.touches[0].clientY;\r\n\t\t\t\tthis.Recorder.start({\r\n\t\t\t\t\tformat: 'mp3'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//录音已经开始\r\n\t\t\tbeginVoice() {\r\n\t\t\t\tif (this.isStopVoice) {\r\n\t\t\t\t\tthis.Recorder.stop();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.voiceTitle = '松开 结束'\r\n\t\t\t\tthis.voiceInterval = setInterval(() => {\r\n\t\t\t\t\tthis.voiceTime++;\r\n\t\t\t\t}, 1000)\r\n\t\t\t},\r\n\t\t\t//move 正在录音中\r\n\t\t\tmoveVoice(e) {\r\n\t\t\t\tconst PointY = e.touches[0].clientY\r\n\t\t\t\tconst slideY = this.PointY - PointY;\r\n\t\t\t\tif (slideY > uni.upx2px(120)) {\r\n\t\t\t\t\tthis.canSend = false;\r\n\t\t\t\t\tthis.voiceIconText = '松开手指 取消发送 '\r\n\t\t\t\t} else if (slideY > uni.upx2px(60)) {\r\n\t\t\t\t\tthis.canSend = true;\r\n\t\t\t\t\tthis.voiceIconText = '手指上滑 取消发送 '\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.voiceIconText = '正在录音... '\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//结束录音\r\n\t\t\tendVoice() {\r\n\t\t\t\tthis.isStopVoice = true; //加锁 确保已经结束录音并不会录制\r\n\t\t\t\tthis.Recorder.stop();\r\n\t\t\t\tthis.voiceTitle = '按住 说话'\r\n\t\t\t},\r\n\t\t\t//录音被打断\r\n\t\t\tcancelVoice(e) {\r\n\t\t\t\tthis.voiceTime = 0;\r\n\t\t\t\tthis.voiceTitle = '按住 说话';\r\n\t\t\t\tthis.canSend = false;\r\n\t\t\t\tthis.Recorder.stop();\r\n\t\t\t},\r\n\t\t\t//处理录音文件\r\n\t\t\thandleRecorder({\r\n\t\t\t\ttempFilePath,\r\n\t\t\t\tduration\r\n\t\t\t}) {\r\n\t\t\t\tlet contentDuration;\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tthis.voiceTime = 0;\r\n\t\t\t\tif (duration < 600) {\r\n\t\t\t\t\tthis.voiceIconText = \"说话时间过短\";\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.recording = false;\r\n\t\t\t\t\t}, 200)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tcontentDuration = duration / 1000;\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\tcontentDuration = this.voiceTime + 1;\r\n\t\t\t\tthis.voiceTime = 0;\r\n\t\t\t\tif (contentDuration <= 0) {\r\n\t\t\t\t\tthis.voiceIconText = \"说话时间过短\";\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.recording = false;\r\n\t\t\t\t\t}, 200)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t};\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tconst params = {\r\n\t\t\t\t\tcontentType: 2,\r\n\t\t\t\t\tcontent: tempFilePath,\r\n\t\t\t\t\tcontentDuration: Math.ceil(contentDuration)\r\n\t\t\t\t};\r\n\t\t\t\tthis.canSend && this.sendMsg(params);\r\n\t\t\t},\r\n\t\t\t//控制播放还是暂停音频文件\r\n\t\t\thandleAudio(item) {\r\n\t\t\t\tthis.AudioExam = item;\r\n\t\t\t\tthis.Audio.paused ? this.playAudio(item) : this.stopAudio(item);\r\n\t\t\t},\r\n\t\t\t//播放音频\r\n\t\t\tplayAudio(item) {\r\n\t\t\t\tthis.Audio.src = item.content;\r\n\t\t\t\tthis.Audio.hasBeenSentId = item.hasBeenSentId;\r\n\t\t\t\tthis.Audio.play();\r\n\t\t\t\titem.anmitionPlay = true;\r\n\t\t\t},\r\n\t\t\t//停止音频\r\n\t\t\tstopAudio(item) {\r\n\t\t\t\titem.anmitionPlay = false;\r\n\t\t\t\tthis.Audio.src = '';\r\n\t\t\t\tthis.Audio.stop();\r\n\t\t\t},\r\n\t\t\t//关闭动画\r\n\t\t\tcloseAnmition() {\r\n\t\t\t\tconst hasBeenSentId = this.Audio.hasBeenSentId;\r\n\t\t\t\tconst item = this.messageList.find(it => it.hasBeenSentId == hasBeenSentId);\r\n\t\t\t\titem.anmitionPlay = false;\r\n\t\t\t},\r\n\t\t\t//点击宫格时触发\r\n\t\t\tclickGrid(index) {\r\n\t\t\t\tif (index == 0) {\r\n\t\t\t\t\tthis.chooseImage(['album'])\r\n\t\t\t\t} else if (index == 1) {\r\n\t\t\t\t\tthis.chooseImage(['camera'])\r\n\t\t\t\t} else if (index == 2) {\r\n\r\n\t\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\t\tthis.popTile = '请选择需要咨询的订单'\r\n\t\t\t\t\tthis.showOrderPopup = true\r\n\t\t\t\t} else if (index == 3) {\r\n\r\n\t\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\t\tthis.showOrderPopup = true\r\n\t\t\t\t\tthis.popTile = '发送商品'\r\n\t\t\t\t} else if (index == 4) {\r\n\t\t\t\t\tlet parmas = {\r\n\t\t\t\t\t\ttoken: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\",\r\n\t\t\t\t\t\ttype: \"cs_list\",\r\n\t\t\t\t\t\troom_type: this.hosType\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.ws.send(parmas)\r\n\t\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\t\tthis.showcustomer = true\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//发送图片\r\n\t\t\tchooseImage(sourceType) {\r\n\t\t\t\tuni.chooseMedia({\r\n\t\t\t\t\tcount: 9,\r\n\t\t\t\t\tmediaType: ['image', 'video'], // 允许图片和视频\r\n\t\t\t\t\tsourceType: sourceType,\r\n\t\t\t\t\tmaxDuration: 15,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconst files = res.tempFiles;\r\n\r\n\t\t\t\t\t\tthis.uploadFiles(files, res.type);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t},\r\n\t\t\t// 选择图片后调用此方法\r\n\t\t\tuploadFiles(tempFilePath, type) {\r\n\r\n\t\t\t\t// 平台判断\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\tthis.uploadImageInH5(tempFilePath);\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// #ifdef MP-WEIXIN || MP-ALIPAY\r\n\t\t\t\tthis.uploadImageInMiniProgram(tempFilePath, type);\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\t// H5 端处理\r\n\t\t\tasync uploadImageInH5(tempFilePath) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 1. 将 Blob URL 转换为 File 对象\r\n\t\t\t\t\tconst response = await fetch(tempFilePath);\r\n\t\t\t\t\tconst blob = await response.blob();\r\n\t\t\t\t\tconst file = new File([blob], 'image.jpg', {\r\n\t\t\t\t\t\ttype: blob.type\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// 2. 构造 FormData\r\n\t\t\t\t\tconst formData = new FormData();\r\n\t\t\t\t\tformData.append('file', file); // 文件字段\r\n\t\t\t\t\tformData.append('userId', '123'); // 其他参数\r\n\r\n\t\t\t\t\t// 3. 发送请求（使用 uni.request 或原生 fetch）\r\n\t\t\t\t\tconst result = await this.sendFormDataRequest(formData);\r\n\t\t\t\t\tconsole.log('上传成功:', result);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error('H5端上传失败:', err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 小程序端处理\r\n\t\t\tuploadImageInMiniProgram(tempFilePath, type) {\r\n\r\n\t\t\t\tconst uploadTasks = tempFilePath.map(file => {\r\n\r\n\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\t\turl: 'http://192.168.0.119:8080/upload/upload2Oss',\r\n\t\t\t\t\t\t\tfilePath: file.tempFilePath,\r\n\t\t\t\t\t\t\tname: 'file', // 参数名需与后端一致\r\n\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t'Authorization': \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\"\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t\t\tclient_id: this.jkId\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\tconst data = JSON.parse(res.data);\r\n\r\n\t\t\t\t\t\t\t\t\t\tthis.sendMsg({\r\n\t\t\t\t\t\t\t\t\t\t\tcontentType: type == 'image' ? 2 : 3,\r\n\t\t\t\t\t\t\t\t\t\t\tcontent: data.data.list[0],\r\n\t\t\t\t\t\t\t\t\t\t\tpath: file.tempFilePath\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\t\treject(new Error('解析响应失败'));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\treject(new Error(`上传失败，状态码：${res.statusCode}`));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 合并所有结果\r\n\t\t\t\tPromise.all(uploadTasks)\r\n\t\t\t\t\t.then(results => {\r\n\t\t\t\t\t\tconst allList = results.flat(); // 合并成完整路径数组\r\n\t\t\t\t\t\tconsole.log('上传成功，文件列表：', allList);\r\n\r\n\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(error => {\r\n\t\t\t\t\t\tconsole.error('上传出错：', error);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '上传失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t},\r\n\t\t\t//查看大图\r\n\t\t\tviewImg(imgList) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\turls: imgList,\r\n\t\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\t\tindicator: 'number'\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t},\r\n\t\tonPageScroll(e) {\r\n\r\n\t\t\t// this.messageList = [...this.historyList , ...this.messageList];\r\n\t\t\t// this.messageList.push({content:'222'})\r\n\t\t},\r\n\r\n\r\n\t\tonNavigationBarButtonTap({\r\n\t\t\tindex\r\n\t\t}) {\r\n\t\t\tif (index == 0) {\r\n\t\t\t\t//用户详情 设置\r\n\t\t\t} else if (index == 1) {\r\n\r\n\t\t\t\t//返回按钮\r\n\t\t\t\tthis.$u.route({\r\n\t\t\t\t\ttype: 'switchTab',\r\n\t\t\t\t\turl: 'pages/home/home'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t//返回按钮事件\r\n\t\tonBackPress(e) {\r\n\t\t\t//以下内容对h5不生效\r\n\t\t\t//--所以如果用浏览器自带的返回按钮进行返回的时候页面不会重定向 正在寻找合适的解决方案\r\n\t\t\tthis.$u.route({\r\n\t\t\t\ttype: 'switchTab',\r\n\t\t\t\turl: 'pages/home/home'\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tconst params = {\r\n\t\t\t\troom_type: this.roomType,\r\n\t\t\t\ttype: \"logout\",\r\n\t\t\t\ttoken: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\"\r\n\t\t\t}\r\n\t\t\tthis.ws.send(params)\r\n\r\n\t\t\tif (this.ws) {\r\n\t\t\t\tthis.ws.close()\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(info) {\r\n\r\n\r\n\t\t\tthis.$nextTick(function () {\r\n\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\tthis.scrollTop = 99999999999\r\n\t\t\t\tthis.$nextTick(function () {\r\n\t\t\t\t\tthis.scrollAnimation = true;\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\r\n\t\t\tconst infoData = JSON.parse(info.data)\r\n\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\ttitle: infoData.title\r\n\t\t\t});\r\n\t\t\tthis.roomType = infoData.room_type\r\n\t\t\tconst params = {\r\n\r\n\t\t\t\tuser_id: null,\r\n\t\t\t\tshop_id: null,\r\n\t\t\t\troom_type: infoData.room_type,\r\n\t\t\t\ttype: \"login\",\r\n\t\t\t\ttoken: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEzMzQ1MTUsImV4cCI6MTc0MzkyNjUxNSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJhZG1pbiIsImFkbWluX3VpZCI6MX19.fZwFbBkcbc4yv_FiGM6kSZ97L9eBNzFt7cAZZ-NR7H8\"\r\n\t\t\t}\r\n\t\t\tthis.hosType = infoData.room_type\r\n\t\t\tif (infoData.room_type === 1 || infoData.room_type === 2 || infoData.room_type === 3) {\r\n\t\t\t\tparams.shop_id = infoData.shop_id\r\n\t\t\t\tthis.hosId = infoData.shop_id\r\n\t\t\t} else {\r\n\t\t\t\tparams.user_id = infoData.user_id\r\n\t\t\t\tthis.hosId = infoData.user_id\r\n\t\t\t}\r\n\r\n\t\t\tthis.infoData = infoData; // 赋值 infoData\r\n\r\n\t\t\tthis.init(params)\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.getList(this.jkId)\r\n\t\t\t})\r\n\r\n\r\n\r\n\t\t\t//录音开始事件\r\n\t\t\tthis.Recorder.onStart(e => {\r\n\r\n\t\t\t\tthis.beginVoice();\r\n\t\t\t});\r\n\t\t\t//录音结束事件\r\n\t\t\tthis.Recorder.onStop(res => {\r\n\t\t\t\tclearInterval(this.voiceInterval);\r\n\t\t\t\tthis.handleRecorder(res);\r\n\t\t\t});\r\n\r\n\t\t\t//音频停止事件\r\n\t\t\tthis.Audio.onStop(e => {\r\n\t\t\t\tthis.closeAnmition();\r\n\t\t\t});\r\n\r\n\t\t\t//音频播放结束事件\r\n\t\t\tthis.Audio.onEnded(e => {\r\n\t\t\t\tthis.closeAnmition();\r\n\t\t\t});\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\t//自定义返回按钮 因为原生的返回按钮不可阻止默认事件\r\n\t\t\t// #ifdef H5\r\n\t\t\tconst icon = document.getElementsByClassName('uni-page-head-btn')[0];\r\n\t\t\ticon.style.display = 'none';\r\n\t\t\t// #endif\r\n\r\n\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\ttitle: this.fromUserInfo.fromUserName\r\n\t\t\t});\r\n\t\t\t// this.joinData();\r\n\t\t\tuni.getSystemInfo({\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthis.imgHeight = res.windowHeight + 'px';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t\tif (res.height == 0) {\r\n\t\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\t\tthis.mpInputMargin = false;\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showFunBtn = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t@import './index.scss'\r\n</style>","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=style&index=0&id=bf16e7f4&lang=scss&scoped=true&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=style&index=0&id=bf16e7f4&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1741946469973\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}