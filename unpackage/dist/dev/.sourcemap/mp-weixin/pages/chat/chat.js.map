{"version":3,"sources":["uni-app:///main.js",null,"webpack:///D:/仿微信wechat/pages/chat/chat.vue?1e4c","webpack:///D:/仿微信wechat/pages/chat/chat.vue?d2ed","webpack:///D:/仿微信wechat/pages/chat/chat.vue?6d72","uni-app:///pages/chat/chat.vue","webpack:///D:/仿微信wechat/pages/chat/chat.vue?4ac6","webpack:///D:/仿微信wechat/pages/chat/chat.vue?d185"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","emojData","showAutoComplete","showQuickReply","selectedQuickReplyItem","roomType","info","kjList","kfListProp","isHistoryLoading","scrollAnimation","scrollTop","scrollToView","windowHeight","swiperIndex","csHeiht","selectedEmoji","msgImgList","historyList","fromUserInfo","formData","content","limit","index","showOrderPopup","showcustomer","ws","hosId","loading","hosType","status","messageList","popTile","jkId","infoLeft","kfTitle","safeAreaInsetBottom","uni","icon","title","uploadType","components","OrderPopup","customer","QuickReply","AutoComplete","watch","emogiBox","showFunBtn","mounted","methods","convertTimestampsToDates","item","key","updateFooterHeight","query","px2rpx","handleInput","clearTimeout","autoComplete","client_id","keywords","SSZAX","resolve","handleSelectSuggestion","handleCloseAutoComplete","dataContent","console","getList","scrollBool","handleQuickReplyClick","del","arr","loadHistory","setTimeout","setPicSize","handleSelectOrder","handleSelect","token","type","room_type","cs_uid","closeBox","closeKf","init","maxReconnect","reconnectDelay","heartbeatInterval","url","duration","res","i","getDataList","gethistoryList","switchChatType","emogiFun","switchFun","tuchEmoj","swiperChange","sendMsg","shop_id","user_id","content_type","sedData","touchstart","linkToBusinessCard","startVoice","format","beginVoice","moveVoice","endVoice","cancelVoice","handleRecorder","tempFilePath","contentDuration","contentType","handleAudio","playAudio","stopAudio","closeAnmition","clickGrid","chooseImage","count","mediaType","sourceType","maxDuration","success","uploadFiles","uploadImageInH5","fetch","response","blob","file","result","uploadImageInMiniProgram","filePath","name","header","path","reject","fail","Promise","then","catch","viewImg","urls","onNavigationBarButtonTap","onBackPress","onUnload","onLoad","params","clearInterval","onReady"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA6H;AAC7H;AACwD;AACL;AACsC;;;AAGzF;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,2FAAM;AACR,EAAE,oGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,+FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,uPAEN;AACP,KAAK;AACL;AACA,aAAa,qOAEN;AACP,KAAK;AACL;AACA,aAAa,2OAEN;AACP,KAAK;AACL;AACA,aAAa,qOAEN;AACP,KAAK;AACL;AACA,aAAa,2OAEN;AACP,KAAK;AACL;AACA,aAAa,+NAEN;AACP,KAAK;AACL;AACA,aAAa,6PAEN;AACP,KAAK;AACL;AACA,aAAa,+NAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,mBAAO,CAAC,6BAAoB;AAClE,yCAAyC,mBAAO,CAAC,gCAAuB;AACxE,WAAW,mBAAO,CAAC,4BAAmB;AACtC,WAAW,mBAAO,CAAC,2BAAkB;AACrC;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACvFA;AAAA;AAAA;AAAA;AAA8lB,CAAgB,wnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;AC2PlnB;AAGA;AAKA;AAGA;AAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAEA;EACAC;IAAA;IACA;MAEAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAEAC,UACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;;MAEAC;MAAA;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC,eACA;MACAC;MACAC;MACAC;MACAC;MACAC;IAAA,kDACA,wDACA,gEACA,wDACA,4DACA,4DACA,4DACA,uDACAC,wEACAA,iFACA,2DACA,6DACA,wDACA,mDACA,qDACA,yDACA,8DACA,wDACA,yDACA,sEACA,4DAEA,oDACA;MACAC;MACAC;MACAC;IACA,GACA;MACAF;MACAC;MACAC;IACA,GACA;MACAF;MACAC;IAEA,GACA;MACAD;MACAC;IACA,GACA;MACAD;MACAC;IACA,EACA,mDACA,gEACA;EAGA;EACAE;IACAC;IACAC;IACAC;IACAC;EACA;EACAC;IAEA;MACA;IAEA;IACA3C;MAEA;QAGA;MAEA;IAEA;IACA4C;MACA;QACA;MAEA;IACA;IACAC;MACA;QACA;MAEA;IACA,EACA;EACA;EAEAC,6BAGA;EACAC;IACA;IACAC;MAAA;MAGA;QAEA,uCACAC,6CACAC;MAEA;IACA;IAEAC;MAAA;MAGA;MACA;QACA;QACAC;UACA;YACA;YACA;YACA;cACA;YAGA;cACA;YACA;UAGA;QACA;MAEA;IACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MAAA;MAKA;QACAC;MACA;MACA;QAEA;UACA;QAEA;;QAEA;MACA;IAGA;IACA;IACAC;MAAA;MACA;QACA;UACAC;UACAC;QACA;UACA;YAEA;cACA;cACA;YACA;cACA;YACA;YACAC;UAEA;UACAC;QACA;UACAA;UACA;QACA;MACA;IACA;IACAC;MAAA;MAGA;MACA;MACA;QACA;QACA;MAEA;IAEA;IACAC;MACA;IACA;IACA;IACAC;MAAA;MACAC;MACA;MACA;MACA;MACA;QACA;QACA;MAEA;IAEA;IACA;IACAC;MAAA;MACAD;MAEA;QACA;UACAP;QACA;UACA;YACA;YACA;YACAO;UAEA;UACAJ;QACA;UACAA;UACA;QACA;MACA;IACA;IACAM;MACA;MACA;MACA;MACAhC;IAEA;IACAiC;MACA;MACA;MACA;MACA;QACA;QACA;UAGA;UACA;QACA;UAGA;UAEA;UACA;QACA;MACA;QACA;QACA;QACA;QACA;MACA;IACA;IACAC;MAEA;MACAC;MACA;MACAL;IACA;IACA;IACAM;MAAA;MAEA;QACA;MACA;MACA;MACA;MACA;MACA;MACAC;QACA;;QAEA;QACA;UAEA;UACA;QACA;QACA;QACA;UACA;UACA;YACA;UACA;QAEA;;QACA;MAEA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;QACA;QACAtD;QACAA;MACA;MACA;IACA;IACA;IACAuD;MAEA;;MAEA;IACA;IACA;IACAC;MACAV;MACA;MACA;QACAW;QACAC;QACAC;QACAC;MACA;MACA;IACA;IACA;IACAC;MAEA;IACA;IACAC;MAEA;IACA;IACAC;MAAA;MACA;MACA;QACAC;QAAA;QACAC;QAAA;QACAC;MACA;;MAEA;MACA;QAEA;MACA;MACA;MACA;MACA;QAAA;MAAA;MACA;QAAA;MAAA;MACA;QAEApB;QAEA;UAEA;UACA;UACA;QAGA;QACA;UAEA;UACA;QAEA;QACA;UAGA;YACA5B;YACAwC;YACAS;UACA;QAEA;QACA;UACA;YACAjD;YACAwC;YACAU;UACA;QAEA;QAEA;UACAC;UACA;UACA;QACA;QACA;UAEA;UACA;UAEA,uBACA;YACAC;YACAA;YACA;cACAA;YACA;cACAA;YACA;UAEA,EAGA;QAEA;MAIA;IACA;IACA;IACAC;MACA;QACAd;QACAC;QACAC;MAEA;MACA;IACA;IAEA;IACAa;MAAA;MAEA;QACA;UACAjC;QACA;UAEA;YACA;UACA;UACAG;QACA;UAEAA;UACA;QACA;MACA;IAEA;IAOA;IACA+B;MAEA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA1D;MACA;MACA;IAGA;IACA;IACA2D;MACA;MACA;MACA;MACA;MACA;MACA3D;IAEA;IACA4D;MACA;IAEA;IACAC;MACA;IACA;IAGA;IACAC;MAAA;MAEA;QACArB;QACAC;QACAqB;QACAC;QACAC;QACAjF;QACA2D;MAEA;MACA;QACAuB;MAEA;QACAA;MACA;MAGA;QACA;UACA;UACAA;UACAA;UACAA;QAEA;UACA;UACAA;UACAA;UACAA;QAGA;UACA;UACAA;UACAA;UACAA;UACAA;UACAA;QAEA;UACA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;QAGA;MACA;QACA;QACA;MACA;MAEA;MAEAA,sBAEAA;MACA;MACA,qBACA;QACAZ;MACA,EAEA;MACA;MACA;MACA;QACA;QACA;QAGA;QAOA;UACA;QACA;QAGA;UACA;QACA;;QAEA;MAIA;IACA;IAGA;IACAa;MACAnE;MACA;MACA;MACA;IAEA;IACA;IACAoE;MACA;MACA;MACA;MACA;MACA;MACA;IAAA,CACA;IACA;IACAC;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAC;MACA;IACA;IACA;IACAC;MAAA;MACA;QACA;QACA;MACA;MACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;QACA;QACA;MACA;QACA;QACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACA;IACAC,+CAGA;MAAA;MAAA,IAFAC;QACAxB;MAEA;MAEA;MACA;QACA;QACAf;UACA;QACA;QACA;MACA;MACAwC;MAeA;MACA;QACAC;QACA9F;QACA6F;MACA;MACA;IACA;IACA;IACAE;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACAjE;IACA;IACA;IACAkE;MACAlE;MACA;MACA;IACA;IACA;IACAmE;MACA;MACA;QAAA;MAAA;MACAnE;IACA;IACA;IACAoE;MACA;QACA;MACA;QACA;MACA;QAEA;QACA;QACA;MACA;QAEA;QACA;QACA;MACA;QACA;UACA1C;UACAC;UACAC;QACA;QACA;QACA;QACA;MACA;IACA;IACA;IACAyC;MAAA;MACApF;QACAqF;QACAC;QAAA;QACAC;QACAC;QACAC;UACA;UAEA;QACA;MACA;IAEA;IACA;IACAC;MAEA;;MAMA;IAEA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAGAC;cAAA;gBAAAC;gBAAA;gBAAA,OACAA;cAAA;gBAAAC;gBACAC;kBACArD;gBACA,IAEA;gBACA3D;gBACAA;gBACAA;;gBAEA;gBAAA;gBAAA,OACA;cAAA;gBAAAiH;gBACAlE;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACA;IACAmE;MAAA;MAEA;QAEA;UACAjG;YACAmD;YACA+C;YACAC;YAAA;YACAC;cACA;YAEA;YACArH;cACAwC;YACA;YACAkE;cACA;gBACA;kBACA;kBAEA;oBACAX;oBACA9F;oBACAqH;kBACA;gBAEA;kBACAC;gBACA;cACA;gBACAA;cACA;YACA;YACAC;cACAD;YACA;UACA;QACA;MACA;;MAEA;MACAE,yBACAC;QACA;QACA3E;MAIA,GACA4E;QACA5E;QACA9B;UACAE;UACAD;QACA;MACA;IAEA;IACA;IACA0G;MACA3G;QACA4G;MAIA;IACA;EACA;EAGAC,mEAEA;IAAA,IADA3H;IAEA;MACA;IAAA,CACA;MAEA;MACA;QACAwD;QACAS;MACA;IACA;EACA;EACA;EACA2D;IACA;IACA;IACA;MACApE;MACAS;IACA;IACA;EACA;EACA4D;IACA;MACApE;MACAD;MACAD;IACA;IACA;IAEA;MACA;IACA;EACA;EAEAuE;IAAA;IACA;IACA9F;MACA;QAEA;QACA;MACA;IACA;IAGAlB;MACAyF;QACA;QACA;QACA3D;;QAEA;QACA;MAEA;IACA;IAIA;IACA9B;MACAE;IACA;IACA;IAGA;MAEA8D;MACAD;MACApB;MACAD;MACAD;IACA;IAEA;IAEA;MACAwE;MACA;IACA;MACAA;MACA;IACA;IAEA;;IAEA;IACA;MAEA;MACA;MACA;MACA;MACA;MACA;QACA;MACA;IAEA;;IAIA;IACA;MAEA;IACA;IACA;IACA;MACAC;MACA;IACA;;IAEA;IACA;MACA;IACA;;IAEA;IACA;MACA;IACA;EACA;EACAC;IAAA;IAGA;;IAMAnH;MACAE;IACA;IACA;IACAF;MACAyF;QACA;MACA;IACA;IAEAzF;MACA;QAEA;MAEA;QACA;MACA;IACA;EAGA;AACA;AAAA,2B;;;;;;;;;;;;;ACz0CA;AAAA;AAAA;AAAA;AAAiqC,CAAgB,uoCAAG,EAAC,C;;;;;;;;;;;ACArrC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=bf16e7f4&scoped=true&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&id=bf16e7f4&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bf16e7f4\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=template&id=bf16e7f4&scoped=true&\"","var components\ntry {\n  components = {\n    uTopTips: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-top-tips/u-top-tips\" */ \"uview-ui/components/u-top-tips/u-top-tips.vue\"\n      )\n    },\n    uToast: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-toast/u-toast\" */ \"uview-ui/components/u-toast/u-toast.vue\"\n      )\n    },\n    uAvatar: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-avatar/u-avatar\" */ \"uview-ui/components/u-avatar/u-avatar.vue\"\n      )\n    },\n    uImage: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-image/u-image\" */ \"uview-ui/components/u-image/u-image.vue\"\n      )\n    },\n    uButton: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-button/u-button\" */ \"uview-ui/components/u-button/u-button.vue\"\n      )\n    },\n    uGrid: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-grid/u-grid\" */ \"uview-ui/components/u-grid/u-grid.vue\"\n      )\n    },\n    uGridItem: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-grid-item/u-grid-item\" */ \"uview-ui/components/u-grid-item/u-grid-item.vue\"\n      )\n    },\n    uIcon: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-icon/u-icon\" */ \"uview-ui/components/u-icon/u-icon.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.kjList.length\n  var m0 = _vm.chatType === \"voice\" ? require(\"@/static/voice.png\") : null\n  var m1 = _vm.chatType === \"keyboard\" ? require(\"@/static/keyboard.png\") : null\n  var m2 = require(\"@/static/face.png\")\n  var m3 = require(\"@/static/add.png\")\n  var g1 = _vm.$u.trim(this.formData.content)\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        m0: m0,\n        m1: m1,\n        m2: m2,\n        m3: m3,\n        g1: g1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n    <view class=\"content\">\r\n\r\n        <u-top-tips ref=\"uTips\"></u-top-tips>\r\n        <u-toast ref=\"uToast\" />\r\n        <view class=\"content-box\" @touchstart=\"touchstart\" id=\"content-box\"\r\n            :class=\"{'emoji-active':showFunBtn, 'emoji-active': emogiBox, 'showQuickReply-active': showQuickReply}\">\r\n            <!-- 背景图- 定位方式 -->\r\n            <!-- \t<image class=\"content-box-bg\" :src=\"_user_info.chatBgImg\" :style=\"{ height: imgHeight }\"></image> -->\r\n            <view class=\"serviceReminder\">\r\n                <u-avatar :src=\"infoData.headimgurl\" size=\"70\"></u-avatar>\r\n                <view class=\"minderText\">\r\n                    {{infoData.title?infoData.title:'系统客服'}},前来服务~\r\n                </view>\r\n            </view>\r\n            <scroll-view class=\"msg-list\" scroll-y=\"true\" :scroll-with-animation=\"scrollAnimation\"\r\n                :scroll-top=\"scrollTop\" :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\"\r\n                ref=\"scrollContainer\" upper-threshold=\"50\" @click=\"scrollBool\">\r\n                <!-- 加载历史数据waitingUI -->\r\n                <view class=\"loading\" v-if=\"isHistoryLoading\">\r\n                    <view class=\"spinner\">\r\n                        <view class=\"rect1\"></view>\r\n                        <view class=\"rect2\"></view>\r\n                        <view class=\"rect3\"></view>\r\n                        <view class=\"rect4\"></view>\r\n                        <view class=\"rect5\"></view>\r\n                    </view>\r\n                </view>\r\n                <view class=\"message\" v-for=\"(item, index) in messageList\" :key=\"index\"\r\n                    :id=\"`msg-${item.hasBeenSentId}`\">\r\n                    <view class=\"timeBox\" v-if=\"item.is_show_time\">\r\n                        {{item.create_time}}\r\n                    </view>\r\n                    <view class=\"message-item \" :class=\"item.is_me ? 'right' : 'left'\">\r\n\r\n                        <!-- contentType = 1 文本 -->\r\n                        <view class=\"contentText\" v-if=\"item.content_type == 1\">{{ item.content }}</view>\r\n                        <!-- contentType = 2 图片 -->\r\n                        <view class=\"contentText contentType3\" v-if=\"item.content_type == 2\"\r\n                            @tap=\"viewImg([item.path])\">\r\n                            <image :src=\"item.path\" class=\"img\" mode=\"widthFix\"></image>\r\n                        </view>\r\n                        <!-- contentType = 3 视频 -->\r\n                        <view class=\"contentVideo \" v-if=\"item.content_type == 3\">\r\n                            <video :src=\"item.path\"></video>\r\n\r\n                        </view>\r\n                        <!-- contentType = 4 商品卡片 -->\r\n                        <view class=\"contentGoods \" v-if=\"item.content_type == 4\">\r\n                            <view class=\"goodsTop\">\r\n                                <view class=\"top_img\">\r\n                                    <u-image :src=\"item.sender_id != undefined?item.content.thumb_url:item.thumb_url\"\r\n                                        width=\"130rpx\" height=\"120rpx\"></u-image>\r\n                                </view>\r\n                                <view class=\"topText\">\r\n                                    <view class=\"text\">\r\n                                        {{item.sender_id != undefined?item.content.title:item.title}}\r\n                                    </view>\r\n                                    <view class=\"price\">\r\n\r\n                                        ￥{{item.sender_id != undefined?item.content.price:item.price}}\r\n                                    </view>\r\n\r\n                                </view>\r\n                            </view>\r\n                            <view class=\"goodsFooter\">\r\n                                <u-button size=\"mini\" shape=\"circle\"\r\n                                    :custom-style=\"{background: '#FF4400',color: '#fff'}\">去购买</u-button>\r\n\r\n                            </view>\r\n                        </view>\r\n                        <!-- contentType = 5 订单卡片 -->\r\n                        <view class=\"contentOrder \" v-if=\"item.content_type == 5\">\r\n                            <view class=\"title\">\r\n                                我要咨询这笔订单\r\n                            </view>\r\n                            <view class=\"goodsTop\">\r\n                                <view class=\"top_img\">\r\n                                    <u-image\r\n                                        :src=\"item.sender_id != undefined?item.content.goods.thumb_url:item.thumb_url\"\r\n                                        width=\"130rpx\" height=\"120rpx\"></u-image>\r\n                                </view>\r\n                                <view class=\"topText\">\r\n                                    <view class=\"text\">\r\n                                        <view class=\"shopText\">\r\n                                            {{item.sender_id != undefined?item.content.shop.title:item.shop_title}}\r\n                                        </view>\r\n                                        <view class=\"title\">\r\n                                            {{item.sender_id != undefined?item.content.goods.title:item.title}}\r\n                                        </view>\r\n                                    </view>\r\n                                    <view class=\"price\">\r\n                                        <view class=\"num1\">\r\n                                            ￥{{item.sender_id != undefined?item.content.goods.price:item.price}}\r\n                                        </view>\r\n                                        <view class=\"num\">\r\n                                            共{{item.sender_id != undefined?item.content.goods.num:item.num}}件商品\r\n                                        </view>\r\n                                    </view>\r\n\r\n                                </view>\r\n                            </view>\r\n\r\n                            <view class=\"orderNum\">\r\n                                <view class=\"bh\">\r\n                                    订单编号:{{item.sender_id != undefined?item.content.order_number:item.order_number}}\r\n                                </view>\r\n                                <view class=\"bh\">\r\n                                    订单时间:{{item.sender_id != undefined?item.content.order_time:item.order_time}}\r\n                                </view>\r\n\r\n\r\n                            </view>\r\n                            <view class=\"goodsFooter\">\r\n                                <u-button size=\"mini\" shape=\"circle\"\r\n                                    :custom-style=\"{background: '#2b85e4',color: '#fff'}\">查看订单</u-button>\r\n\r\n                            </view>\r\n                        </view>\r\n\r\n\r\n\r\n                        <!-- contentType = 2 语音 -->\r\n                        <!-- {{item.hasBeenSentId != undefined?item.content.title:item.title}}-->\r\n                        <!-- \t\t\t\t\t<view class=\"content contentType2\" :class=\"[{ 'content-type-right': item.is_me }]\"\r\n\t\t\t\t\t\tv-if=\"item.content_type == 3\" @tap=\"handleAudio(item)\" hover-class=\"contentType2-hover-class\"\r\n\t\t\t\t\t\t:style=\"{width:`${130+(item.contentDuration*2)}rpx`}\">\r\n\t\t\t\t\t\t<view class=\"voice_icon\" :class=\"[\r\n\t\t\t\t\t\t\t\t{ voice_icon_right: item.is_me },\r\n\t\t\t\t\t\t\t\t{ voice_icon_left: !item.is_me },\r\n\t\t\t\t\t\t\t\t{ voice_icon_right_an: item.anmitionPlay && item.is_me },\r\n\t\t\t\t\t\t\t\t{ voice_icon_left_an: item.anmitionPlay && !item.is_me }\r\n\t\t\t\t\t\t\t]\"></view>\r\n\t\t\t\t\t\t<view class=\"\">{{ item.contentDuration }}''</view>\r\n\t\t\t\t\t</view> -->\r\n\r\n\r\n                    </view>\r\n                </view>\r\n            </scroll-view>\r\n            <view class=\"kjBox\" v-if=\"kjList.length > 0\">\r\n                <view class=\"quick-reply\" v-for=\"(item, index) in kjList\" :key=\"index\"\r\n                    @click=\"handleQuickReplyClick(item,index)\"\r\n                    :class=\"{ 'selected': selectedQuickReplyIndex === index }\">\r\n                    {{item.name}}\r\n\r\n                </view>\r\n            </view>\r\n        </view>\r\n\r\n        <!-- 底部聊天输入框 -->\r\n        <view class=\"input-box\" :class=\"{ 'input-box-mpInputMargin': mpInputMargin }\" ref=\"footerRef\"\r\n            @touchmove.stop.prevent>\r\n            <view class=\"input-box-flex\">\r\n                <!-- #ifndef H5 -->\r\n                <image v-if=\"chatType === 'voice'\" class=\"icon_img\" :src=\"require('@/static/voice.png')\"\r\n                    @click=\"switchChatType('keyboard')\"></image>\r\n                <image v-if=\"chatType === 'keyboard'\" class=\"icon_img\" :src=\"require('@/static/keyboard.png')\"\r\n                    @click=\"switchChatType('voice')\"></image>\r\n                <!-- #endif -->\r\n                <view class=\"input-box-flex-grow\">\r\n                    <textarea v-if=\"chatType === 'voice'\" type=\"text\" class=\"content\" id=\"input\"\r\n                        v-model=\"formData.content\" :hold-keyboard=\"true\" :confirm-type=\"'send'\" :confirm-hold=\"true\"\r\n                        auto-height=\"true\" placeholder-style=\"color:#DDDDDD;\" :cursor-spacing=\"10\" @input=\"handleInput\"\r\n                        @confirm=\"sendMsg(null)\" ref=\"input\" :show-confirm-bar='false' confirm-type=\"done\" />\r\n                    <!-- <textarea v-model=\"formData.content\" v-if=\"chatType === 'voice'\" id=\"input\" \r\n                        border=\"true\"  auto-height=\"true\" clearable=\"false\" :cursor-spacing=\"10\"\r\n                        adjust-position=\"true\" @input=\"handleInput\" @confirm=\"sendMsg(null)\"\r\n                        :hold-keyboard=\"true\" :confirm-hold=\"true\" class=\"content\" /> -->\r\n\r\n\r\n                    <view class=\"voice_title\" v-if=\"chatType === 'keyboard'\"\r\n                        :style=\"{ background: recording ? '#c7c6c6' : '#FFFFFF' }\" @touchstart.stop.prevent=\"startVoice\"\r\n                        @touchmove.stop.prevent=\"moveVoice\" @touchend.stop=\"endVoice\" @touchcancel.stop=\"cancelVoice\">\r\n                        {{ voiceTitle }}\r\n                    </view>\r\n                </view>\r\n                <!-- 表情按钮 -->\r\n                <image class=\"emoji icon_btn_add\" :src=\"require('@/static/face.png')\" @tap=\"emogiFun\"></image>\r\n                <!-- 功能性按钮 -->\r\n                <image class=\" icon_btn_add\" :src=\"require('@/static/add.png')\" @tap=\"switchFun\"></image>\r\n\r\n                <!-- #ifdef H5 -->\r\n                <button class=\"btn\" type=\"primary\" size=\"mini\" @touchend.prevent=\"sendMsg(null)\">发送</button>\r\n                <!-- #endif -->\r\n            </view>\r\n\r\n            <view class=\"fun-box\" :class=\"{'show-fun-box':showFunBtn}\">\r\n                <u-grid :col=\"4\" hover-class=\"contentType2-hover-class\" :border=\"false\" @click=\"clickGrid\">\r\n                    <u-grid-item v-for=\"(item, index) in funList\" :index=\"index\" :key=\"index\" bg-color=\"#eaeaea\">\r\n                        <u-icon :name=\"item.icon\" :size=\"52\"></u-icon>\r\n                        <view class=\"grid-text\">{{ item.title }}</view>\r\n                    </u-grid-item>\r\n                </u-grid>\r\n            </view>\r\n            <!-- 表情选择 -->\r\n            <view class=\"fun-box\" :class=\"{'show-fun-box':emogiBox}\">\r\n                <swiper :current=\"swiperIndex\" style=\"height: 100%;\" @change=\"swiperChange\" :indicator-dots=\"true\">\r\n                    <swiper-item v-for=\"(items, index) in emojData\" :key=\"index\">\r\n                        <view class=\"emoj-container\">\r\n                            <view class=\"emoj-row\">\r\n                                <view class=\"emoj-parent\" v-for=\"(item, i) in items\" :key=\"i\" hover-class=\"checkActive\"\r\n                                    hover-stay-time=\"100\" @click=\"tuchEmoj(item)\">\r\n                                    <text class=\"emoj-conn\">{{ item }}</text>\r\n                                </view>\r\n                            </view>\r\n                        </view>\r\n                    </swiper-item>\r\n\r\n                </swiper>\r\n                <view class=\"buttonBox\" v-if=\"$u.trim(this.formData.content)\">\r\n                    <u-button size='mini' class=\"firstBut\" :custom-style=\"{background: '#fff'}\" @click=\"del\">\r\n                        <u-icon name=\"backspace\" size=\"30\" color='#000'></u-icon>\r\n                    </u-button>\r\n                    <u-button size='mini' type=\"primary\" hairline=\"false\" @click=\"sendMsg\">发送</u-button>\r\n                </view>\r\n            </view>\r\n            <!-- 快捷用语入口 -->\r\n            <QuickReply :visible=\"showQuickReply\" :item=\"selectedQuickReplyItem\" :commonList='commonList'\r\n                @dataContent=\"dataContent\" />\r\n        </view>\r\n        <!-- 占位元素（同步动态高度） -->\r\n        <div class=\"footer-placeholder\" :style=\"{ height: dynamicFooterHeight + 'rpx' }\"></div>\r\n        </div>\r\n        <AutoComplete :visible=\"showAutoComplete\" :query=\"formData.content\" @select=\"handleSelectSuggestion\"\r\n            @close=\"handleCloseAutoComplete\" :comPleteLikst=\"comPleteLikst\" />\r\n\r\n        <!-- 订单商品弹出 -->\r\n        <order-popup :visible=\"showOrderPopup\" @select=\"handleSelectOrder\" :jkid='jkId' @closeBox='closeBox'\r\n            :title='popTile' />\r\n        <!-- 客服 -->\r\n        <customer :visible=\"showcustomer\" @select=\"handleSelect\" @closeBox='closeKf' :kfListProp='kfListProp'>\r\n        </customer>\r\n        <!-- //语音动画 -->\r\n        <view class=\"voice_an\" v-if=\"recording\">\r\n            <view class=\"voice_an_icon\">\r\n                <view id=\"one\" class=\"wave\"></view>\r\n                <view id=\"two\" class=\"wave\"></view>\r\n                <view id=\"three\" class=\"wave\"></view>\r\n                <view id=\"four\" class=\"wave\"></view>\r\n                <view id=\"five\" class=\"wave\"></view>\r\n                <view id=\"six\" class=\"wave\"></view>\r\n                <view id=\"seven\" class=\"wave\"></view>\r\n            </view>\r\n            <view class=\"text\">{{voiceIconText}}</view>\r\n        </view>\r\n    </view>\r\n\r\n</template>\r\n\r\n<script>\r\n    import {\r\n        LOGIN_URL\r\n    } from '../../env';\r\n    import WebSocketUtil from '@/socket.js'\r\n    import OrderPopup from '@/components/popup.vue'\r\n    import customer from '@/components/customer.vue'\r\n    import QuickReply from '@/components/QuickReply.vue';\r\n    import AutoComplete from '@/components/AutoComplete.vue';\r\n    import {\r\n        formatTime\r\n    } from '@/filter/index.js'\r\n    import { emojData } from '@/utils/emojData.js';\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n\r\n                emojData,\r\n                showAutoComplete: false,\r\n                showQuickReply: false,\r\n                selectedQuickReplyItem: null,\r\n                roomType: '',\r\n                info: {},\r\n\r\n                kjList: [\r\n                ],\r\n                kfListProp: [],\r\n                isHistoryLoading: false,\r\n                scrollAnimation: false,\r\n                scrollTop: 0,\r\n                scrollToView: '',\r\n                windowHeight: 0, // 动态计算高度\r\n\r\n                swiperIndex: 0, // 初始 swiper 索引\r\n                csHeiht: null,\r\n                selectedEmoji: null, // 用于保存用户选择的表情\r\n                msgImgList: [],\r\n                historyList: [],\r\n                fromUserInfo: {},\r\n                formData: {\r\n                    content: '',\r\n                    limit: 20,\r\n                    index: 1\r\n                },\r\n                showOrderPopup: false,\r\n                showcustomer: false,\r\n                ws: null,\r\n                hosId: '',\r\n                loading: true, //标识是否正在获取数据\r\n                hosType: '',\r\n                status: 'disconnected',\r\n                messageList: [\r\n                ],\r\n                popTile: '',\r\n                jkId: '',\r\n                infoLeft: {},\r\n                kfTitle: '',\r\n                safeAreaInsetBottom: null,\r\n                loading: true, //标识是否正在获取数据\r\n                imgHeight: '1000px',\r\n                mpInputMargin: false, //适配微信小程序 底部输入框高度被顶起的问题\r\n                chatType: \"voice\", // 图标类型 'voice'语音 'keyboard'键盘\r\n                voiceTitle: '按住 说话',\r\n                commonList: [],\r\n                throttleTimeout: null,\r\n                Recorder: uni.getRecorderManager(),\r\n                Audio: uni.createInnerAudioContext(),\r\n                recording: false, //标识是否正在录音\r\n                isStopVoice: false, //加锁 防止点击过快引起的当录音正在准备(还没有开始录音)的时候,却调用了stop方法但并不能阻止录音的问题\r\n                voiceInterval: null,\r\n                voiceTime: 0, //总共录音时长\r\n                canSend: true, //是否可以发送\r\n                PointY: 0, //坐标位置\r\n                voiceIconText: \"正在录音...\",\r\n                showFunBtn: false, //是否展示功能型按钮\r\n                emogiBox: false, //是否展示表情选择\r\n                AudioExam: null, //正在播放音频的实例\r\n                selectedQuickReplyIndex: null,\r\n\r\n                comPleteLikst: [],\r\n                funList: [{\r\n                    icon: \"photo-fill\",\r\n                    title: \"照片\",\r\n                    uploadType: [\"album\"]\r\n                },\r\n                {\r\n                    icon: \"camera-fill\",\r\n                    title: \"拍摄\",\r\n                    uploadType: [\"camera\"]\r\n                },\r\n                {\r\n                    icon: \"order\",\r\n                    title: \"订单\",\r\n\r\n                },\r\n                {\r\n                    icon: \"bag-fill\",\r\n                    title: \"商品\",\r\n                },\r\n                {\r\n                    icon: \"kefu-ermai\",\r\n                    title: \"客服\"\r\n                }\r\n                ],\r\n                infoData: {}, // 初始化 infoData\r\n                dynamicFooterHeight: 0, // 初始高度\r\n\r\n            };\r\n        },\r\n        components: {\r\n            OrderPopup,\r\n            customer,\r\n            QuickReply,\r\n            AutoComplete\r\n        },\r\n        watch: {\r\n\r\n            'formData.content': function (newVal, oldVal) {\r\n                this.updateFooterHeight();\r\n\r\n            },\r\n            showQuickReply(val) {\r\n\r\n                if (!val) {\r\n\r\n\r\n                    this.updateFooterHeight()\r\n\r\n                }\r\n\r\n            },\r\n            emogiBox(val) {\r\n                if (!val) {\r\n                    this.updateFooterHeight()\r\n\r\n                }\r\n            },\r\n            showFunBtn(val) {\r\n                if (!val) {\r\n                    this.updateFooterHeight()\r\n\r\n                }\r\n            }\r\n            // 其他监听器...\r\n        },\r\n\r\n        mounted() {\r\n\r\n\r\n        },\r\n        methods: {\r\n            // 转换函数\r\n            convertTimestampsToDates(dataArray, key = 'create_time') {\r\n\r\n\r\n                return dataArray.map(item => {\r\n\r\n                    return {\r\n                        ...item,\r\n                        [key]: formatTime(item[key]), // 转换时间戳\r\n                    };\r\n                });\r\n            },\r\n\r\n            updateFooterHeight(num) {\r\n\r\n\r\n                // 使用 UniApp API 获取节点高度\r\n                this.$nextTick(() => {\r\n                    const query = uni.createSelectorQuery().in(this);\r\n                    query.select('.input-box-flex').boundingClientRect(res => {\r\n                        if (res) {\r\n                            let heightInPx = res.height;\r\n                            let heightInRpx = this.px2rpx(heightInPx);\r\n                            if (num) {\r\n                                this.dynamicFooterHeight = heightInRpx + num;\r\n\r\n\r\n                            } else {\r\n                                this.dynamicFooterHeight = heightInRpx;\r\n                            }\r\n\r\n\r\n                        }\r\n                    }).exec();\r\n\r\n                });\r\n            },\r\n            // 转换px\r\n            px2rpx(px) {\r\n                const screenWidth = uni.getSystemInfoSync().screenWidth;\r\n                return (750 / screenWidth) * px;\r\n            },\r\n            handleInput(e) {\r\n\r\n\r\n\r\n\r\n                if (this.throttleTimeout) {\r\n                    clearTimeout(this.throttleTimeout);\r\n                }\r\n                this.throttleTimeout = setTimeout(() => {\r\n\r\n                    if (!(e.target.value.trim().length === 0)) {\r\n                        this.autoComplete(this.jkId, e.target.value);\r\n\r\n                    }\r\n\r\n                    // this.showAutoComplete = !!this.formData.content;\r\n                }, 300); // 300 毫秒的节流时间\r\n\r\n\r\n            },\r\n            //模糊搜索\r\n            autoComplete(val, content) {\r\n                return new Promise((resolve, reject) => {\r\n                    this.$api('autoComplete', {\r\n                        client_id: val,\r\n                        keywords: content\r\n                    }).then(res => {\r\n                        if (res.status == 200) {\r\n\r\n                            if (res.data) {\r\n                                this.showAutoComplete = true\r\n                                this.comPleteLikst = res.data.list\r\n                            } else {\r\n                                this.showAutoComplete = false\r\n                            }\r\n                            SSZAX\r\n\r\n                        }\r\n                        resolve(true);\r\n                    }).catch((e) => {\r\n                        resolve(false);\r\n                        // console.log(e);\r\n                    });\r\n                })\r\n            },\r\n            handleSelectSuggestion(item) {\r\n\r\n\r\n                this.formData.content = item;\r\n                this.showAutoComplete = false;\r\n                this.$nextTick(() => {\r\n                    this.updateFooterHeight();\r\n                    // 或通过事件触发\r\n\r\n                });\r\n\r\n            },\r\n            handleCloseAutoComplete() {\r\n                this.showAutoComplete = false;\r\n            },\r\n            //获取传递的文字\r\n            dataContent(data) {\r\n                console.log(data);\r\n                this.formData.content = data\r\n                this.showQuickReply = false;\r\n                this.selectedQuickReplyIndex = null\r\n                this.$nextTick(() => {\r\n                    this.updateFooterHeight();\r\n                    // 或通过事件触发\r\n\r\n                });\r\n\r\n            },\r\n            //获取分类\r\n            getList(val) {\r\n                console.log(val);\r\n\r\n                return new Promise((resolve, reject) => {\r\n                    this.$api('getCateList', {\r\n                        client_id: val\r\n                    }).then(res => {\r\n                        if (res.status == 200) {\r\n                            this.kjList = res.data.common_list\r\n                            this.commonList = res.data.cate_list\r\n                            console.log(this.commonList);\r\n\r\n                        }\r\n                        resolve(true);\r\n                    }).catch((e) => {\r\n                        resolve(false);\r\n                        // console.log(e);\r\n                    });\r\n                })\r\n            },\r\n            scrollBool() {\r\n                this.showQuickReply = false;\r\n                this.showFunBtn = false\r\n                this.emogiBox = false\r\n                uni.hideKeyboard()\r\n\r\n            },\r\n            handleQuickReplyClick(item, index) {\r\n                this.emogiBox = false;\r\n                this.showFunBtn = false;\r\n                this.scrollToView = 'msg-0';\r\n                if (index == 0) {\r\n                    this.updateFooterHeight(600);\r\n                    if (this.selectedQuickReplyIndex === index) {\r\n\r\n\r\n                        this.selectedQuickReplyIndex = null;\r\n                        this.showQuickReply = false;\r\n                    } else {\r\n\r\n\r\n                        this.selectedQuickReplyIndex = index;\r\n\r\n                        this.selectedQuickReplyItem = item;\r\n                        this.showQuickReply = true;\r\n                    }\r\n                } else {\r\n                    this.updateFooterHeight();\r\n                    this.showQuickReply = false;\r\n                    this.formData.content = item.content;\r\n                    this.selectedQuickReplyIndex = null; // 点击其他项时不高亮\r\n                }\r\n            },\r\n            del() {\r\n\r\n                let arr = Array.from(this.formData.content); // 按字符拆分为数组\r\n                arr = arr.slice(0, -1); // 删除最后一个字符\r\n                this.formData.content = arr.join('');\r\n                console.log(this.formData.content);\r\n            },\r\n            //触发滑动到顶部(加载历史信息记录)\r\n            loadHistory(e) {\r\n\r\n                if (this.isHistoryLoading) {\r\n                    return;\r\n                }\r\n                this.isHistoryLoading = true; //参数作为进入请求标识，防止重复请求\r\n                this.scrollAnimation = false; //关闭滑动动画\r\n                // let Viewid = this.messageList[0].msg.id;//记住第一个信息ID\r\n                //本地模拟请求历史记录效果\r\n                setTimeout(() => {\r\n                    // 消息列表\r\n\r\n                    // 获取消息中的图片,并处理显示尺寸\r\n                    for (let i = 0; i < this.historyList.length; i++) {\r\n\r\n                        this.historyList[i].hasBeenSentId = Math.floor(Math.random() * 1000 + 1);\r\n                        this.messageList.unshift(this.historyList[i]);\r\n                    }\r\n                    //这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n                    this.$nextTick(function () {\r\n                        this.scrollToView = 'msg-19'\r\n                        this.$nextTick(function () {\r\n                            this.scrollAnimation = true; //恢复滚动动画\r\n                        });\r\n\r\n                    });\r\n                    this.isHistoryLoading = false;\r\n\r\n                }, 1000)\r\n            },\r\n\r\n            //处理图片尺寸，如果不处理宽高，新进入页面加载图片时候会闪\r\n            setPicSize(content) {\r\n                // 让图片最长边等于设置的最大长度，短边等比例缩小，图片控件真实改变，区别于aspectFit方式。\r\n                let maxW = uni.upx2px(350); //350是定义消息图片最大宽度\r\n                let maxH = uni.upx2px(350); //350是定义消息图片最大高度\r\n                if (content.w > maxW || content.h > maxH) {\r\n                    let scale = content.w / content.h;\r\n                    content.w = scale > 1 ? maxW : maxH * scale;\r\n                    content.h = scale > 1 ? maxW / scale : maxH;\r\n                }\r\n                return content;\r\n            },\r\n            //选中订单\r\n            handleSelectOrder(item) {\r\n\r\n                this.sendMsg(item)\r\n\r\n                // 跳转到订单详情页或其他操作\r\n            },\r\n            //转接客服\r\n            handleSelect(item) {\r\n                console.log(item);\r\n                this.kfTitle = item.name\r\n                const params = {\r\n                    token: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzY3NjIsImV4cCI6MTc0MzY2ODc2MiwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJzaG9wIiwic2hvcF9pZCI6MTUsInNob3BfdWlkIjo3Nn19.vAcvBN_W46zBRXoDpT1wtERtC3wBJPC7rdhAc79hJuI\",\r\n                    type: \"switch_cs\",\r\n                    room_type: this.hosType,\r\n                    cs_uid: item.cs_uid\r\n                }\r\n                this.ws.send(params)\r\n            },\r\n            //关闭\r\n            closeBox(data) {\r\n\r\n                this.showOrderPopup = data\r\n            },\r\n            closeKf(data) {\r\n\r\n                this.showcustomer = data\r\n            },\r\n            init(data) {\r\n                // 初始化 WebSocket\r\n                this.ws = new WebSocketUtil('wss://192.168.0.119:8088', {\r\n                    maxReconnect: 5, // 最大重连次数\r\n                    reconnectDelay: 2000, // 重连间隔\r\n                    heartbeatInterval: 100000 // 心跳间隔\r\n                });\r\n\r\n                // 监听事件\r\n                this.ws.on('open', () => {\r\n\r\n                    this.status = 'connected'\r\n                });\r\n                this.ws.send(data)\r\n                this.ws.startHeartbeat(data)\r\n                this.ws.on('close', () => this.status = 'disconnected');\r\n                this.ws.on('error', (err) => console.error('发生错误:', err));\r\n                this.ws.on('message', (res) => {\r\n\r\n                    console.log(res);\r\n\r\n                    if (res.type == 'onConnect') {\r\n\r\n                        this.jkId = res.data.client_id\r\n                        //历史记录\r\n                        this.gethistoryList(this.jkId)\r\n\r\n\r\n                    }\r\n                    if (res.type == 'cs_list') {\r\n\r\n                        //客服列表\r\n                        this.kfListProp = res.data.list\r\n\r\n                    }\r\n                    if (res.type == 'switch_cs') {\r\n\r\n\r\n                        this.$refs.uToast.show({\r\n                            title: `${this.kfTitle}转接成功`,\r\n                            type: 'success',\r\n                            url: '/pages/home/home'\r\n                        })\r\n\r\n                    }\r\n                    if (res.type == 'error') {\r\n                        this.$refs.uTips.show({\r\n                            title: res.message,\r\n                            type: 'error',\r\n                            duration: '2300'\r\n                        })\r\n\r\n                    }\r\n\r\n                    if (res.type == 'dialog') {\r\n                        res.data.is_me = false\r\n                        this.messageList.push(res.data)\r\n                        this.scrollToView = 'msg-0';\r\n                    }\r\n                    if (res.type == 'login') {\r\n\r\n                        this.messageList = this.convertTimestampsToDates(res.data.list);\r\n                        this.info = res.data.sender_info\r\n\r\n                        this.messageList.map(\r\n                            (i, index) => {\r\n                                i.path = i.content\r\n                                i.hasBeenSentId = this.messageList.length - 1 - index\r\n                                if (i.is_me) {\r\n                                    i.is_me = true\r\n                                } else {\r\n                                    i.is_me = false\r\n                                }\r\n\r\n                            }\r\n\r\n\r\n                        )\r\n\r\n                    }\r\n\r\n\r\n\r\n                });\r\n            },\r\n            //客服\r\n            getDataList() {\r\n                const params = {\r\n                    token: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzY3NjIsImV4cCI6MTc0MzY2ODc2MiwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJzaG9wIiwic2hvcF9pZCI6MTUsInNob3BfdWlkIjo3Nn19.vAcvBN_W46zBRXoDpT1wtERtC3wBJPC7rdhAc79hJuI\",\r\n                    type: \"cs_list\",\r\n                    room_type: this.hosType,\r\n\r\n                }\r\n                this.ws.send(params)\r\n            },\r\n\r\n            // 加载历史消息\r\n            gethistoryList(page) {\r\n\r\n                return new Promise((resolve, reject) => {\r\n                    this.$api('history', {\r\n                        client_id: page\r\n                    }).then(res => {\r\n\r\n                        if (res.status == 200) {\r\n                            this.historyList = this.convertTimestampsToDates(res.data.list);\r\n                        }\r\n                        resolve(true);\r\n                    }).catch((e) => {\r\n\r\n                        resolve(false);\r\n                        // console.log(e);\r\n                    });\r\n                })\r\n\r\n            },\r\n\r\n\r\n\r\n\r\n\r\n\r\n            //切换语音或者键盘方式\r\n            switchChatType(type) {\r\n\r\n                this.chatType = type;\r\n                this.showFunBtn = false;\r\n            },\r\n            //打开表情选项\r\n            emogiFun() {\r\n                this.chatType = 'voice'\r\n                this.emogiBox = !this.emogiBox;\r\n                this.showFunBtn = false;\r\n                this.showQuickReply = false;\r\n                this.scrollToView = 'msg-0';\r\n                uni.hideKeyboard();\r\n                // this.scrollToView = 'msg-0';\r\n                this.updateFooterHeight(300)\r\n\r\n\r\n            },\r\n            //切换功能性按钮\r\n            switchFun() {\r\n                this.updateFooterHeight(300)\r\n                this.chatType = 'voice'\r\n                this.showFunBtn = !this.showFunBtn;\r\n                this.emogiBox = false\r\n                this.showQuickReply = false;\r\n                uni.hideKeyboard()\r\n\r\n            },\r\n            tuchEmoj(item) {\r\n                this.formData.content += item\r\n\r\n            },\r\n            swiperChange(e) {\r\n                this.swiperIndex = e.detail.current;\r\n            },\r\n\r\n\r\n            //发送消息\r\n            sendMsg(data) {\r\n\r\n                const sedData = {\r\n                    token: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\",\r\n                    type: 'dialog',\r\n                    shop_id: null,\r\n                    user_id: null,\r\n                    content_type: 1,\r\n                    content: this.formData.content,\r\n                    room_type: this.hosType\r\n\r\n                }\r\n                if (this.hosType === 1 || this.hosType === 2 || this.hosType === 3) {\r\n                    sedData.shop_id = this.hosId\r\n\r\n                } else {\r\n                    sedData.user_id = this.hosId\r\n                }\r\n\r\n\r\n                if (data) {\r\n                    if (data.contentType == 3) {\r\n                        //说明是发送视频\r\n                        sedData.path = data.path\r\n                        sedData.content = data.content;\r\n                        sedData.content_type = data.contentType;\r\n\r\n                    } else if (data.contentType == 2) {\r\n                        //发送图片\r\n                        sedData.path = data.path\r\n                        sedData.content = data.content;\r\n                        sedData.content_type = data.contentType;\r\n\r\n\r\n                    } else if (data.contentType == 4) {\r\n                        //商品\r\n                        sedData.content = data.id\r\n                        sedData.content_type = data.contentType;\r\n                        sedData.thumb_url = data.thumb_url\r\n                        sedData.title = data.title\r\n                        sedData.price = data.price\r\n\r\n                    } else if (data.contentType == 5) {\r\n                        //订单\r\n                        sedData.content = data.fatherId + ':' + data.id\r\n                        sedData.content_type = data.contentType;\r\n                        sedData.thumb_url = data.thumb_url\r\n                        sedData.title = data.title\r\n                        sedData.price = data.price\r\n                        sedData.order_number = data.order_number\r\n                        sedData.order_time = data.order_time\r\n                        sedData.shop_title = data.shop_title\r\n                        sedData.num = data.num\r\n\r\n\r\n                    }\r\n                } else if (!this.$u.trim(this.formData.content)) {\r\n                    //验证输入框书否为空字符传\r\n                    return;\r\n                }\r\n\r\n                this.ws.send(sedData)\r\n\r\n                sedData.is_me = true,\r\n\r\n                    sedData.headimgurl = this.info.headimgurl\r\n                this.messageList.push(sedData);\r\n                this.messageList.map(\r\n                    (i, index) => {\r\n                        i.hasBeenSentId = this.messageList.length - 1 - index\r\n                    }\r\n\r\n                )\r\n                this.showQuickReply = false\r\n                this.selectedQuickReplyIndex = null;\r\n                this.$nextTick(() => {\r\n                    // this.dynamicFooterHeight = this.csHeiht\r\n                    this.formData.content = '';\r\n                    // #ifdef MP-WEIXIN\r\n\r\n                    this.scrollToView = 'msg-0'\r\n                    // #endif\r\n\r\n                    // #ifndef MP-WEIXIN\r\n                    this.scrollToView = 'msg-0'\r\n                    // #endif\r\n\r\n                    if (this.showFunBtn) {\r\n                        this.showFunBtn = false;\r\n                    }\r\n\r\n                    // #ifdef MP-WEIXIN \r\n                    if (sedData.contentType == 1) {\r\n                        this.mpInputMargin = true;\r\n                    }\r\n                    // #endif\r\n                    //h5浏览器并没有很好的办法控制键盘一直处于唤起状态 而且会有样式性的问题\r\n                    // #ifdef H5\r\n                    uni.hideKeyboard();\r\n                    // #endif\r\n                });\r\n            },\r\n\r\n\r\n            //用户触摸屏幕的时候隐藏键盘\r\n            touchstart() {\r\n                uni.hideKeyboard();\r\n                this.showFunBtn = false\r\n                this.emogiBox = false\r\n                this.selectedQuickReplyIndex = null\r\n\r\n            },\r\n            // userid 用户id\r\n            linkToBusinessCard(userId) {\r\n                // this.$u.route({\r\n                // \turl: 'pages/businessCard/businessCard',\r\n                // \tparams: {\r\n                // \t\tuserId\r\n                // \t}\r\n                // });\r\n            },\r\n            //准备开始录音\r\n            startVoice(e) {\r\n                if (!this.Audio.paused) {\r\n                    //如果音频正在播放 先暂停。\r\n                    this.stopAudio(this.AudioExam)\r\n                }\r\n                this.recording = true;\r\n                this.isStopVoice = false;\r\n                this.canSend = true;\r\n                this.voiceIconText = \"正在录音...\"\r\n                this.PointY = e.touches[0].clientY;\r\n                this.Recorder.start({\r\n                    format: 'mp3'\r\n                });\r\n            },\r\n            //录音已经开始\r\n            beginVoice() {\r\n                if (this.isStopVoice) {\r\n                    this.Recorder.stop();\r\n                    return;\r\n                }\r\n                this.voiceTitle = '松开 结束'\r\n                this.voiceInterval = setInterval(() => {\r\n                    this.voiceTime++;\r\n                }, 1000)\r\n            },\r\n            //move 正在录音中\r\n            moveVoice(e) {\r\n                const PointY = e.touches[0].clientY\r\n                const slideY = this.PointY - PointY;\r\n                if (slideY > uni.upx2px(120)) {\r\n                    this.canSend = false;\r\n                    this.voiceIconText = '松开手指 取消发送 '\r\n                } else if (slideY > uni.upx2px(60)) {\r\n                    this.canSend = true;\r\n                    this.voiceIconText = '手指上滑 取消发送 '\r\n                } else {\r\n                    this.voiceIconText = '正在录音... '\r\n                }\r\n            },\r\n            //结束录音\r\n            endVoice() {\r\n                this.isStopVoice = true; //加锁 确保已经结束录音并不会录制\r\n                this.Recorder.stop();\r\n                this.voiceTitle = '按住 说话'\r\n            },\r\n            //录音被打断\r\n            cancelVoice(e) {\r\n                this.voiceTime = 0;\r\n                this.voiceTitle = '按住 说话';\r\n                this.canSend = false;\r\n                this.Recorder.stop();\r\n            },\r\n            //处理录音文件\r\n            handleRecorder({\r\n                tempFilePath,\r\n                duration\r\n            }) {\r\n                let contentDuration;\r\n                // #ifdef MP-WEIXIN\r\n                this.voiceTime = 0;\r\n                if (duration < 600) {\r\n                    this.voiceIconText = \"说话时间过短\";\r\n                    setTimeout(() => {\r\n                        this.recording = false;\r\n                    }, 200)\r\n                    return;\r\n                }\r\n                contentDuration = duration / 1000;\r\n                // #endif\r\n\r\n                // #ifdef APP-PLUS\r\n                contentDuration = this.voiceTime + 1;\r\n                this.voiceTime = 0;\r\n                if (contentDuration <= 0) {\r\n                    this.voiceIconText = \"说话时间过短\";\r\n                    setTimeout(() => {\r\n                        this.recording = false;\r\n                    }, 200)\r\n                    return;\r\n                };\r\n                // #endif\r\n\r\n                this.recording = false;\r\n                const params = {\r\n                    contentType: 2,\r\n                    content: tempFilePath,\r\n                    contentDuration: Math.ceil(contentDuration)\r\n                };\r\n                this.canSend && this.sendMsg(params);\r\n            },\r\n            //控制播放还是暂停音频文件\r\n            handleAudio(item) {\r\n                this.AudioExam = item;\r\n                this.Audio.paused ? this.playAudio(item) : this.stopAudio(item);\r\n            },\r\n            //播放音频\r\n            playAudio(item) {\r\n                this.Audio.src = item.content;\r\n                this.Audio.hasBeenSentId = item.hasBeenSentId;\r\n                this.Audio.play();\r\n                item.anmitionPlay = true;\r\n            },\r\n            //停止音频\r\n            stopAudio(item) {\r\n                item.anmitionPlay = false;\r\n                this.Audio.src = '';\r\n                this.Audio.stop();\r\n            },\r\n            //关闭动画\r\n            closeAnmition() {\r\n                const hasBeenSentId = this.Audio.hasBeenSentId;\r\n                const item = this.messageList.find(it => it.hasBeenSentId == hasBeenSentId);\r\n                item.anmitionPlay = false;\r\n            },\r\n            //点击宫格时触发\r\n            clickGrid(index) {\r\n                if (index == 0) {\r\n                    this.chooseImage(['album'])\r\n                } else if (index == 1) {\r\n                    this.chooseImage(['camera'])\r\n                } else if (index == 2) {\r\n\r\n                    this.showFunBtn = false;\r\n                    this.popTile = '请选择需要咨询的订单'\r\n                    this.showOrderPopup = true\r\n                } else if (index == 3) {\r\n\r\n                    this.showFunBtn = false;\r\n                    this.showOrderPopup = true\r\n                    this.popTile = '发送商品'\r\n                } else if (index == 4) {\r\n                    let parmas = {\r\n                        token: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\",\r\n                        type: \"cs_list\",\r\n                        room_type: this.hosType\r\n                    }\r\n                    this.ws.send(parmas)\r\n                    this.showFunBtn = false;\r\n                    this.showcustomer = true\r\n                }\r\n            },\r\n            //发送图片\r\n            chooseImage(sourceType) {\r\n                uni.chooseMedia({\r\n                    count: 9,\r\n                    mediaType: ['image', 'video'], // 允许图片和视频\r\n                    sourceType: sourceType,\r\n                    maxDuration: 15,\r\n                    success: (res) => {\r\n                        const files = res.tempFiles;\r\n\r\n                        this.uploadFiles(files, res.type);\r\n                    }\r\n                });\r\n\r\n            },\r\n            // 选择图片后调用此方法\r\n            uploadFiles(tempFilePath, type) {\r\n\r\n                // 平台判断\r\n                // #ifdef H5\r\n                this.uploadImageInH5(tempFilePath);\r\n                // #endif\r\n\r\n                // #ifdef MP-WEIXIN || MP-ALIPAY\r\n                this.uploadImageInMiniProgram(tempFilePath, type);\r\n                // #endif\r\n            },\r\n            // H5 端处理\r\n            async uploadImageInH5(tempFilePath) {\r\n                try {\r\n                    // 1. 将 Blob URL 转换为 File 对象\r\n                    const response = await fetch(tempFilePath);\r\n                    const blob = await response.blob();\r\n                    const file = new File([blob], 'image.jpg', {\r\n                        type: blob.type\r\n                    });\r\n\r\n                    // 2. 构造 FormData\r\n                    const formData = new FormData();\r\n                    formData.append('file', file); // 文件字段\r\n                    formData.append('userId', '123'); // 其他参数\r\n\r\n                    // 3. 发送请求（使用 uni.request 或原生 fetch）\r\n                    const result = await this.sendFormDataRequest(formData);\r\n                    console.log('上传成功:', result);\r\n                } catch (err) {\r\n                    console.error('H5端上传失败:', err);\r\n                }\r\n            },\r\n            // 小程序端处理\r\n            uploadImageInMiniProgram(tempFilePath, type) {\r\n\r\n                const uploadTasks = tempFilePath.map(file => {\r\n\r\n                    return new Promise((resolve, reject) => {\r\n                        uni.uploadFile({\r\n                            url: 'http://192.168.0.119:8080/upload/upload2Oss',\r\n                            filePath: file.tempFilePath,\r\n                            name: 'file', // 参数名需与后端一致\r\n                            header: {\r\n                                'Authorization': \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\"\r\n\r\n                            },\r\n                            formData: {\r\n                                client_id: this.jkId\r\n                            },\r\n                            success: (res) => {\r\n                                if (res.statusCode === 200) {\r\n                                    try {\r\n                                        const data = JSON.parse(res.data);\r\n\r\n                                        this.sendMsg({\r\n                                            contentType: type == 'image' ? 2 : 3,\r\n                                            content: data.data.list[0],\r\n                                            path: file.tempFilePath\r\n                                        })\r\n\r\n                                    } catch (e) {\r\n                                        reject(new Error('解析响应失败'));\r\n                                    }\r\n                                } else {\r\n                                    reject(new Error(`上传失败，状态码：${res.statusCode}`));\r\n                                }\r\n                            },\r\n                            fail: (err) => {\r\n                                reject(err);\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n\r\n                // 合并所有结果\r\n                Promise.all(uploadTasks)\r\n                    .then(results => {\r\n                        const allList = results.flat(); // 合并成完整路径数组\r\n                        console.log('上传成功，文件列表：', allList);\r\n\r\n\r\n\r\n                    })\r\n                    .catch(error => {\r\n                        console.error('上传出错：', error);\r\n                        uni.showToast({\r\n                            title: '上传失败',\r\n                            icon: 'none'\r\n                        });\r\n                    });\r\n\r\n            },\r\n            //查看大图\r\n            viewImg(imgList) {\r\n                uni.previewImage({\r\n                    urls: imgList,\r\n                    // #ifndef MP-WEIXIN\r\n                    indicator: 'number'\r\n                    // #endif\r\n                });\r\n            },\r\n        },\r\n\r\n\r\n        onNavigationBarButtonTap({\r\n            index\r\n        }) {\r\n            if (index == 0) {\r\n                //用户详情 设置\r\n            } else if (index == 1) {\r\n\r\n                //返回按钮\r\n                this.$u.route({\r\n                    type: 'switchTab',\r\n                    url: 'pages/home/home'\r\n                });\r\n            }\r\n        },\r\n        //返回按钮事件\r\n        onBackPress(e) {\r\n            //以下内容对h5不生效\r\n            //--所以如果用浏览器自带的返回按钮进行返回的时候页面不会重定向 正在寻找合适的解决方案\r\n            this.$u.route({\r\n                type: 'switchTab',\r\n                url: 'pages/home/home'\r\n            });\r\n            return true;\r\n        },\r\n        onUnload() {\r\n            const params = {\r\n                room_type: this.roomType,\r\n                type: \"logout\",\r\n                token: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzQ4ODUsImV4cCI6MTc0MzY2Njg4NSwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJ1c2VyIiwidXNlcl9pZCI6NDd9fQ.Ave2qlEte478fxGKlAD_Zbicmx-o27HG3LEnhHVoRLk\"\r\n            }\r\n            this.ws.send(params)\r\n\r\n            if (this.ws) {\r\n                this.ws.close()\r\n            }\r\n        },\r\n\r\n        onLoad(info) {\r\n            const query = uni.createSelectorQuery().in(this);\r\n            query.select('.input-box-flex').boundingClientRect(res => {\r\n                if (res) {\r\n\r\n                    this.csHeiht = res.height\r\n                    let csHeiht = this.px2rpx(csHeiht); // 将 px 转换为 rpx\r\n                }\r\n            }).exec();\r\n\r\n\r\n            uni.getSystemInfo({\r\n                success: (res) => {\r\n                    // 获取安全区域底部插入值\r\n                    const safeAreaInsetBottom = res.safeAreaInsets ? res.safeAreaInsets.bottom : 0;\r\n                    console.log('Safe Area Inset Bottom:', safeAreaInsetBottom);\r\n\r\n                    // 在这里可以使用 safeAreaInsetBottom 的值\r\n                    this.safeAreaInsetBottom = safeAreaInsetBottom;\r\n\r\n                }\r\n            });\r\n\r\n\r\n\r\n            const infoData = JSON.parse(info.data)\r\n            uni.setNavigationBarTitle({\r\n                title: infoData.title\r\n            });\r\n            this.roomType = infoData.room_type\r\n\r\n\r\n            const params = {\r\n\r\n                user_id: infoData.user_id,\r\n                shop_id: infoData.shop_id,\r\n                room_type: infoData.room_type,\r\n                type: \"login\",\r\n                token: \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NDEwNzY3NjIsImV4cCI6MTc0MzY2ODc2MiwiZGF0YSI6eyJ1c2VyX3R5cGUiOiJzaG9wIiwic2hvcF9pZCI6MTUsInNob3BfdWlkIjo3Nn19.vAcvBN_W46zBRXoDpT1wtERtC3wBJPC7rdhAc79hJuI\"\r\n            }\r\n\r\n            this.hosType = infoData.room_type\r\n\r\n            if (infoData.room_type === 1 || infoData.room_type === 2 || infoData.room_type === 3) {\r\n                params.shop_id = infoData.shop_id\r\n                this.hosId = infoData.shop_id\r\n            } else {\r\n                params.user_id = infoData.user_id\r\n                this.hosId = infoData.user_id\r\n            }\r\n\r\n            this.infoData = infoData; // 赋值 infoData\r\n\r\n            this.init(params)\r\n            this.$nextTick(() => {\r\n\r\n                //进入页面滚动到底部\r\n                this.updateFooterHeight();\r\n                //客服\r\n                this.getDataList()\r\n                this.getList(this.jkId)\r\n                this.$nextTick(() => {\r\n                    this.scrollTop = 99999999\r\n                });\r\n\r\n            })\r\n\r\n\r\n\r\n            //录音开始事件\r\n            this.Recorder.onStart(e => {\r\n\r\n                this.beginVoice();\r\n            });\r\n            //录音结束事件\r\n            this.Recorder.onStop(res => {\r\n                clearInterval(this.voiceInterval);\r\n                this.handleRecorder(res);\r\n            });\r\n\r\n            //音频停止事件\r\n            this.Audio.onStop(e => {\r\n                this.closeAnmition();\r\n            });\r\n\r\n            //音频播放结束事件\r\n            this.Audio.onEnded(e => {\r\n                this.closeAnmition();\r\n            });\r\n        },\r\n        onReady() {\r\n\r\n\r\n            //自定义返回按钮 因为原生的返回按钮不可阻止默认事件\r\n            // #ifdef H5\r\n            const icon = document.getElementsByClassName('uni-page-head-btn')[0];\r\n            icon.style.display = 'none';\r\n            // #endif\r\n\r\n            uni.setNavigationBarTitle({\r\n                title: this.fromUserInfo.fromUserName ? this.fromUserInfo.fromUserName : '系统客服'\r\n            });\r\n            // this.joinData();\r\n            uni.getSystemInfo({\r\n                success: res => {\r\n                    this.imgHeight = res.windowHeight + 'px';\r\n                }\r\n            });\r\n\r\n            uni.onKeyboardHeightChange(res => {\r\n                if (res.height == 0) {\r\n                    // #ifdef MP-WEIXIN\r\n                    this.mpInputMargin = false;\r\n                    // #endif\r\n                } else {\r\n                    this.showFunBtn = false;\r\n                }\r\n            });\r\n\r\n\r\n        }\r\n    };\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    @import './index.scss'\r\n</style>","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=style&index=0&id=bf16e7f4&lang=scss&scoped=true&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=style&index=0&id=bf16e7f4&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1742290311657\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}